<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TitleGuard AI - Title Search Assistant</title>
    <meta name="description" content="Digital Title Abstractor and Real Estate Data Analyst - Comprehensive preliminary title search tool">
    <meta name="keywords" content="title search, real estate, property search, title abstractor, real estate data">
    <meta name="author" content="TitleGuard AI">
    
    <!-- Accessibility -->
    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" content="#667eea">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TitleGuard AI">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://title-guard.netlify.app/">
    <meta property="og:title" content="TitleGuard AI - Title Search Assistant">
    <meta property="og:description" content="Digital Title Abstractor and Real Estate Data Analyst">
    <meta property="og:image" content="https://title-guard.netlify.app/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://title-guard.netlify.app/">
    <meta property="twitter:title" content="TitleGuard AI - Title Search Assistant">
    <meta property="twitter:description" content="Digital Title Abstractor and Real Estate Data Analyst">
    <meta property="twitter:image" content="https://title-guard.netlify.app/og-image.png">

    <!-- Performance Optimizations -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
    <!-- Critical CSS -->
    <style>
        /* Critical above-the-fold styles */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .loading-skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Service Worker for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
    <style>
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Modern gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Modern shadows */
        .shadow-modern {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .shadow-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Smooth animations */
        .transition-all {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Modern button hover effects */
        .btn-modern {
            position: relative;
            overflow: hidden;
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-modern:hover::before {
            left: 100%;
        }
        
        /* Card hover effects */
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Modern input focus */
        .input-modern:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            border-color: #667eea;
        }
        
        /* Status indicators */
        .status-clear {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .status-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .status-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-6">
                    <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h1 class="text-5xl font-bold text-white mb-4">TitleGuard AI</h1>
                <p class="text-xl text-white text-opacity-90 mb-6">Digital Title Abstractor and Real Estate Data Analyst</p>
                <div class="inline-flex items-center px-4 py-2 bg-white bg-opacity-20 rounded-full text-white text-sm font-medium">
                    <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Powered by Advanced AI Technology
                </div>
            </div>
        </div>
        <!-- Decorative elements -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
            <div class="absolute -top-40 -right-40 w-80 h-80 bg-white bg-opacity-5 rounded-full"></div>
            <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-white bg-opacity-5 rounded-full"></div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div id="app">
            <!-- Search Form -->
            <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 mb-8 card-hover">
                <div class="w-full max-w-2xl mx-auto">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Start Your Title Search</h2>
                        <p class="text-gray-600">Enter a property address to begin comprehensive title analysis</p>
                    </div>
                    
                    <form id="searchForm" class="space-y-6">
                        <!-- Search Type Selection -->
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 border border-blue-100">
                            <h3 class="text-sm font-semibold text-gray-700 mb-3">Search Method</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label class="flex items-center p-3 bg-white rounded-lg border-2 border-transparent hover:border-blue-200 cursor-pointer transition-all duration-200">
                                    <input type="radio" name="searchType" value="address" checked class="text-blue-600 focus:ring-blue-500">
                                    <div class="ml-3">
                                        <div class="flex items-center">
                                            <svg class="w-4 h-4 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                            </svg>
                                            <span class="text-sm font-medium text-gray-700">Property Address</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Search by street address</p>
                                    </div>
                                </label>
                                
                                <label class="flex items-center p-3 bg-white rounded-lg border-2 border-transparent hover:border-blue-200 cursor-pointer transition-all duration-200">
                                    <input type="radio" name="searchType" value="tax" class="text-blue-600 focus:ring-blue-500">
                                    <div class="ml-3">
                                        <div class="flex items-center">
                                            <svg class="w-4 h-4 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                            </svg>
                                            <span class="text-sm font-medium text-gray-700">Tax ID</span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Search by Tax ID/Parcel Number</p>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Dynamic Search Input -->
                        <div class="relative">
                            <label for="searchInput" id="searchLabel" class="block text-sm font-semibold text-gray-700 mb-3">
                                Property Address
                            </label>
                            <div class="relative">
                                <input
                                    type="text"
                                    id="searchInput"
                                    placeholder="Enter property address (e.g., 123 Main St, Anytown, USA)"
                                    class="input-modern w-full px-6 py-4 pl-14 pr-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-transparent outline-none transition-all duration-300 text-lg"
                                    autocomplete="address-line1"
                                    spellcheck="false"
                                />
                                <svg id="searchIcon" class="absolute left-5 top-1/2 transform -translate-y-1/2 h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <div id="searchSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden mt-1 max-h-60 overflow-y-auto"></div>
                            </div>
                            <div id="searchValidation" class="mt-2 text-sm"></div>
                        </div>
                        
                        <!-- Advanced Search Options -->
                        <div class="bg-gray-50 rounded-xl p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold text-gray-700">Advanced Search Options</h3>
                                <button type="button" id="toggleAdvanced" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                    <span id="toggleText">Show Options</span>
                                    <svg id="toggleIcon" class="inline w-4 h-4 ml-1 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>
                            </div>
                            <div id="advancedOptions" class="hidden space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-600 mb-2">Search Depth</label>
                                        <select id="searchDepth" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                            <option value="50">50 Years (Standard)</option>
                                            <option value="70">70 Years (Comprehensive)</option>
                                            <option value="100">100 Years (Complete)</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-medium text-gray-600 mb-2">Report Detail Level</label>
                                        <select id="reportDetail" class="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm">
                                            <option value="standard">Standard Report</option>
                                            <option value="detailed">Detailed Analysis</option>
                                            <option value="comprehensive">Comprehensive Review</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="includeTaxHistory" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="ml-2 text-sm text-gray-700">Include Tax History</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="includeZoning" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="ml-2 text-sm text-gray-700">Include Zoning Info</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button
                            type="submit"
                            id="searchBtn"
                            class="btn-modern w-full gradient-bg hover:shadow-glow text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 flex items-center justify-center space-x-3 text-lg"
                        >
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <span>Search Title</span>
                        </button>
                    </form>
                    
                    <div class="mt-8 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-100">
                        <p class="font-semibold text-gray-800 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Test Properties Available
                        </p>
                        <div class="space-y-3">
                            <!-- Property 1 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center mb-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                    <span class="font-medium text-gray-800">Property 1: Clear Title</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        </svg>
                                        <span class="text-gray-600">123 Main St, Anytown, USA</span>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <span class="text-gray-600">Tax ID: R12345-001-002</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Property 2 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center mb-2">
                                    <div class="w-2 h-2 bg-orange-500 rounded-full mr-3"></div>
                                    <span class="font-medium text-gray-800">Property 2: Issues Found</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        </svg>
                                        <span class="text-gray-600">456 Oak Avenue, Springfield, IL</span>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <span class="text-gray-600">Tax ID: R67890-003-001</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 border border-blue-200 rounded-2xl p-8 mb-8 card-hover">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">How TitleGuard AI Works</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="flex items-start space-x-3">
                                    <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
                                    <p class="text-gray-700 font-medium">Enter a property address in the search field above</p>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</div>
                                    <p class="text-gray-700 font-medium">AI performs comprehensive analysis including:</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Property ownership verification</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">50-year chain of title analysis</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Encumbrance and lien search</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Tax status verification</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex items-center space-x-3">
                            <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</div>
                            <p class="text-gray-700 font-medium">Review the generated preliminary title report</p>
                        </div>
                        <div class="mt-3 flex items-center space-x-3">
                            <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</div>
                            <p class="text-gray-700 font-medium">Export the report as PDF for your records</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Display (Hidden Initially) -->
            <div id="reportDisplay" class="hidden">
                <!-- Report content will be generated here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-white bg-opacity-20 rounded-full mb-4">
                    <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">TitleGuard AI</h3>
                <p class="text-white text-opacity-80 mb-6">Automated Title Search Assistant</p>
                <p class="text-white text-opacity-70 text-sm mb-6 max-w-2xl mx-auto">
                    This tool is for informational purposes only and does not provide legal advice or title insurance. 
                    All findings must be verified by qualified professionals before any real estate transaction.
                </p>
                <div class="flex justify-center space-x-6">
                    <a href="https://github.com/washingtonwizkidspodcast-gif/Title-Guard" class="text-white text-opacity-80 hover:text-opacity-100 transition-all duration-300 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        <span>GitHub</span>
                    </a>
                    <span class="text-white text-opacity-50">â€¢</span>
                    <a href="https://netlify.com" class="text-white text-opacity-80 hover:text-opacity-100 transition-all duration-300 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6.5 0C2.91 0 0 2.91 0 6.5c0 1.77.74 3.37 1.93 4.5L12 23l10.07-12c1.19-1.13 1.93-2.73 1.93-4.5C24 2.91 21.09 0 17.5 0S11 2.91 11 6.5c0 .5.07 1 .2 1.47L12 12l.8-4.03c.13-.47.2-.97.2-1.47C13 2.91 10.09 0 6.5 0z"/>
                        </svg>
                        <span>Netlify</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mock data for different properties
        const mockProperties = {
            "123 Main St, Anytown, USA": {
                parcelNumber: "R12345-001-002",
                taxId: "TX-12345-001",
                currentOwner: "John Doe and Jane Doe",
                legalDescription: "LOT 1, BLOCK 2, ANYTOWN ESTATES, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 15, PAGE 42, OF THE PUBLIC RECORDS OF ANYCOUNTY, USA.",
                propertySitus: "123 Main St, Anytown, USA",
                ownershipChain: [
                    { owner: "John Doe and Jane Doe", from: "Robert Seller", deedType: "Warranty Deed", date: "2023-05-15", docNum: "2023-00456" },
                    { owner: "Robert Seller", from: "Emily Investor", deedType: "Grant Deed", date: "2010-03-22", docNum: "2010-00123" },
                    { owner: "Emily Investor", from: "Historic Holdings LLC", deedType: "Warranty Deed", date: "1995-08-10", docNum: "1995-00567" },
                    { owner: "Historic Holdings LLC", from: "Margaret Johnson", deedType: "Quitclaim Deed", date: "1978-12-05", docNum: "1978-00890" },
                    { owner: "Margaret Johnson", from: "William Johnson", deedType: "Warranty Deed", date: "1965-04-18", docNum: "1965-00234" }
                ],
                encumbrances: [
                    { type: "Mortgage", parties: ["John Doe and Jane Doe", "Big Bank Inc."], date: "2023-05-15", docNum: "2023-00457", status: "Potentially Open" },
                    { type: "Utility Easement", parties: ["Electric Company"], date: "2010-05-15", docNum: "2010-00189", status: "Active", description: "Grants access to the rear 10 feet of the property" },
                    { type: "Federal Tax Lien", parties: ["IRS", "Emily Investor"], date: "2012-08-01", docNum: "2012-00987", status: "Potentially Open", amount: "$15,200" }
                ],
                taxStatus: "Paid",
                amountOwed: "0.00",
                taxLiens: "None"
            },
            "456 Oak Avenue, Springfield, IL": {
                parcelNumber: "R67890-003-001",
                taxId: "TX-67890-003",
                currentOwner: "Sarah Williams",
                legalDescription: "LOT 3, BLOCK 1, OAK GROVE SUBDIVISION, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 8, PAGE 15, OF THE PUBLIC RECORDS OF SPRINGFIELD COUNTY, ILLINOIS.",
                propertySitus: "456 Oak Avenue, Springfield, IL",
                ownershipChain: [
                    { owner: "Sarah Williams", from: "Michael Thompson", deedType: "Warranty Deed", date: "2021-09-12", docNum: "2021-00789" },
                    { owner: "Michael Thompson", from: "Linda Davis", deedType: "Grant Deed", date: "2005-11-30", docNum: "2005-00456" },
                    { owner: "Linda Davis", from: "James Davis", deedType: "Warranty Deed", date: "1988-07-14", docNum: "1988-00234" },
                    { owner: "James Davis", from: "Estate of Robert Davis", deedType: "Personal Representative Deed", date: "1972-03-08", docNum: "1972-00112" }
                ],
                encumbrances: [
                    { type: "Mortgage", parties: ["Sarah Williams", "First National Bank"], date: "2021-09-12", docNum: "2021-00790", status: "Potentially Open" },
                    { type: "HOA Lien", parties: ["Oak Grove HOA", "Sarah Williams"], date: "2023-01-15", docNum: "2023-00045", status: "Potentially Open", amount: "$2,400" },
                    { type: "Mechanic's Lien", parties: ["ABC Construction", "Linda Davis"], date: "1990-05-20", docNum: "1990-00123", status: "Potentially Open", amount: "$8,500" }
                ],
                taxStatus: "Delinquent",
                amountOwed: "3,247.50",
                taxLiens: "Tax lien filed 2023-03-01, Document #2023-00156"
            }
        };

        // Find property by address
        function findPropertyByAddress(address) {
            const normalizedAddress = address.toLowerCase().trim();
            for (const [key, value] of Object.entries(mockProperties)) {
                if (key.toLowerCase().includes(normalizedAddress.split(',')[0]) || 
                    normalizedAddress.includes(key.toLowerCase().split(',')[0])) {
                    return { address: key, data: value };
                }
            }
            return null;
        }
        
        // Enhanced property lookup function for multiple search types
        function findPropertyBySearchInput(searchInput, searchType) {
            const normalizedInput = searchInput.toLowerCase().trim();
            
            for (const [key, value] of Object.entries(mockProperties)) {
                switch (searchType) {
                    case 'address':
                        if (key.toLowerCase().includes(normalizedInput.split(',')[0]) || 
                            normalizedInput.includes(key.toLowerCase().split(',')[0])) {
                            return { address: key, data: value };
                        }
                        break;
                    case 'tax':
                        // Search both parcel number and tax ID
                        if (value.parcelNumber.toLowerCase().includes(normalizedInput) ||
                            (value.taxId && value.taxId.toLowerCase().includes(normalizedInput))) {
                            return { address: key, data: value };
                        }
                        break;
                }
            }
            return null;
        }

        // Analyze title condition
        function analyzeTitleCondition(encumbrances) {
            const openMortgages = encumbrances.filter(e => e.status === 'Potentially Open' && e.type === 'Mortgage');
            const taxLiens = encumbrances.filter(e => e.status === 'Potentially Open' && e.type.includes('Tax Lien'));
            const otherLiens = encumbrances.filter(e => e.status === 'Potentially Open' && !e.type.includes('Mortgage') && !e.type.includes('Tax Lien'));

            if (openMortgages.length > 0 || taxLiens.length > 0 || otherLiens.length > 0) {
                return 'Significant Clouds Detected - Professional Review Required';
            } else if (encumbrances.length > 0) {
                return 'Exceptions Found';
            } else {
                return 'Appears Clear';
            }
        }

        // Analyze chain of title
        function analyzeChainOfTitle(chain) {
            const gaps = [];
            const defects = [];

            for (let i = 0; i < chain.length - 1; i++) {
                const current = chain[i];
                const next = chain[i + 1];
                
                if (current.from !== next.owner) {
                    gaps.push(`Gap detected between ${current.owner} and ${next.owner}`);
                }
            }

            chain.forEach(entry => {
                if (entry.deedType === 'Quitclaim Deed' && !entry.owner.includes('Estate') && !entry.from.includes('Estate')) {
                    defects.push(`Quitclaim deed used in non-familial transfer: ${entry.from} to ${entry.owner}`);
                }
            });

            if (gaps.length > 0 || defects.length > 0) {
                return `WARNING: Issues detected in chain of title. ${gaps.join('; ')} ${defects.join('; ')}`;
            } else {
                return 'Chain appears complete and unbroken back to 1970.';
            }
        }

        // Generate report HTML
        function generateReportHTML(reportData, address) {
            const currentDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const titleCondition = analyzeTitleCondition(reportData.encumbrances);
            const chainAnalysis = analyzeChainOfTitle(reportData.ownershipChain);

            return `
                <div class="max-w-4xl mx-auto space-y-8">
                    <!-- Report Header -->
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                        <div class="text-center">
                            <h1 class="text-2xl font-bold text-gray-900 mb-2 flex items-center justify-center">
                                <svg class="h-8 w-8 mr-3 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                Preliminary Title Report
                            </h1>
                            <p class="text-gray-600 mb-4">Prepared for: Client</p>
                            <p class="text-gray-600 mb-4">Subject Property: ${address}</p>
                            <p class="text-sm text-gray-500">Generated on: ${currentDate}</p>
                        </div>
                        
                        <!-- Critical Disclaimer -->
                        <div class="mt-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-red-800">CRITICAL DISCLAIMER</h3>
                                    <p class="text-sm text-red-700 mt-1">
                                        This is an informational, automated report based on a search of online public records. 
                                        It is NOT a substitute for a professional title examination or a policy of title insurance. 
                                        Data may be incomplete or inaccurate. All findings must be verified by a qualified 
                                        abstractor, attorney, or title company before any real estate transaction.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Buttons -->
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-6 card-hover">
                        <div class="flex flex-wrap gap-3">
                            <button onclick="exportToPDF('${address}')" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                                <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Export PDF
                            </button>
                        </div>
                    </div>

                    <!-- Executive Summary -->
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            Executive Summary
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Current Owner</label>
                                    <p class="text-lg font-semibold text-gray-900">${reportData.currentOwner}</p>
                                </div>
                                
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Parcel ID (APN)</label>
                                    <p class="text-lg font-mono text-gray-900">${reportData.parcelNumber}</p>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Tax Status</label>
                                    <p class="text-lg font-semibold ${reportData.taxStatus === 'Paid' ? 'text-green-600' : 'text-red-600'}">
                                        ${reportData.taxStatus === 'Paid' ? 'Current' : `DELINQUENT - $${reportData.amountOwed} Owed`}
                                    </p>
                                </div>
                                
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Title Condition</label>
                                    <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${getTitleConditionColor(titleCondition)}">
                                        ${getTitleConditionIcon(titleCondition)}
                                        ${titleCondition}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Property & Vesting Information -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Property & Vesting Information</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Property Address</label>
                                    <p class="text-gray-900">${reportData.propertySitus}</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Current Vesting</label>
                                    <p class="text-gray-900">${reportData.currentOwner}</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Vesting Deed</label>
                                    <p class="text-gray-900">
                                        ${reportData.ownershipChain[0]?.deedType}, Document #${reportData.ownershipChain[0]?.docNum}, 
                                        Recorded ${reportData.ownershipChain[0]?.date}
                                    </p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Legal Description</label>
                                    <p class="text-sm text-gray-600">${reportData.legalDescription}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chain of Title -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Chain of Title (50-Year History)
                        </h2>
                        
                        <div class="space-y-4">
                            ${reportData.ownershipChain.map((entry, index) => `
                                <div class="border-l-4 border-blue-200 pl-4 py-2">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <p class="font-semibold text-gray-900">${entry.owner}</p>
                                            <p class="text-sm text-gray-600">
                                                from <span class="font-medium">${entry.from}</span>
                                            </p>
                                        </div>
                                        <div class="text-right text-sm text-gray-500">
                                            <p class="font-medium">${entry.deedType}</p>
                                            <p>${entry.date}</p>
                                            <p class="font-mono text-xs">Doc #${entry.docNum}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-semibold text-gray-900 mb-2">Chain Analysis</h3>
                            <p class="text-sm text-gray-700">${chainAnalysis}</p>
                        </div>
                    </div>

                    <!-- Schedule B -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            Schedule B: Exceptions & Encumbrances
                        </h2>
                        
                        ${reportData.encumbrances.length === 0 ? `
                            <div class="text-center py-8">
                                <svg class="h-12 w-12 text-green-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-lg font-medium text-gray-900">No significant encumbrances found.</p>
                                <p class="text-sm text-gray-600 mt-2">This property appears to have a clear title.</p>
                            </div>
                        ` : `
                            <div class="space-y-4">
                                ${reportData.encumbrances.map((encumbrance, index) => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <h3 class="font-semibold text-gray-900">${encumbrance.type}</h3>
                                            <div class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(encumbrance.status)}">
                                                ${getStatusIcon(encumbrance.status)}
                                                <span class="ml-1">${encumbrance.status}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="space-y-2 text-sm">
                                            <div>
                                                <span class="font-medium text-gray-700">Parties:</span>
                                                <span class="ml-2 text-gray-600">${encumbrance.parties.join(' and ')}</span>
                                            </div>
                                            
                                            <div>
                                                <span class="font-medium text-gray-700">Details:</span>
                                                <span class="ml-2 text-gray-600">
                                                    Document #${encumbrance.docNum}, Recorded ${encumbrance.date}
                                                </span>
                                            </div>
                                            
                                            ${encumbrance.amount ? `
                                                <div>
                                                    <span class="font-medium text-gray-700">Amount:</span>
                                                    <span class="ml-2 text-gray-600">${encumbrance.amount}</span>
                                                </div>
                                            ` : ''}
                                            
                                            ${encumbrance.description ? `
                                                <div>
                                                    <span class="font-medium text-gray-700">Description:</span>
                                                    <span class="ml-2 text-gray-600">${encumbrance.description}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Helper functions for styling
        function getTitleConditionColor(condition) {
            switch (condition) {
                case 'Appears Clear':
                    return 'status-clear text-white';
                case 'Exceptions Found':
                    return 'status-warning text-white';
                case 'Significant Clouds Detected - Professional Review Required':
                    return 'status-danger text-white';
                default:
                    return 'text-gray-600 bg-gray-50';
            }
        }

        function getTitleConditionIcon(condition) {
            switch (condition) {
                case 'Significant Clouds Detected - Professional Review Required':
                    return '<svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                case 'Exceptions Found':
                    return '<svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                case 'Appears Clear':
                    return '<svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                default:
                    return '';
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Potentially Open':
                    return 'text-red-600 bg-red-50';
                case 'Satisfied':
                    return 'text-green-600 bg-green-50';
                case 'Active':
                    return 'text-blue-600 bg-blue-50';
                default:
                    return 'text-yellow-600 bg-yellow-50';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case 'Potentially Open':
                    return '<svg class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                case 'Satisfied':
                    return '<svg class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                case 'Active':
                    return '<svg class="h-5 w-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>';
                default:
                    return '<svg class="h-5 w-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            }
        }

        // Export to PDF function
        function exportToPDF(address) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            let yPosition = 20;

            // Title
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Preliminary Title Report', pageWidth / 2, yPosition, { align: 'center' });
            yPosition += 15;

            // Property info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Subject Property: ${address}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, yPosition);
            yPosition += 20;

            // Disclaimer
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('CRITICAL DISCLAIMER:', 20, yPosition);
            yPosition += 8;
            doc.setFont('helvetica', 'normal');
            const disclaimerText = 'This is an informational, automated report based on a search of online public records. It is NOT a substitute for a professional title examination or a policy of title insurance. Data may be incomplete or inaccurate. All findings must be verified by a qualified abstractor, attorney, or title company before any real estate transaction.';
            const disclaimerLines = doc.splitTextToSize(disclaimerText, pageWidth - 40);
            doc.text(disclaimerLines, 20, yPosition);
            yPosition += disclaimerLines.length * 5 + 15;

            // Executive Summary
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('Executive Summary', 20, yPosition);
            yPosition += 10;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            
            const property = findPropertyByAddress(address);
            if (property) {
                doc.text(`Current Owner: ${property.data.currentOwner}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Parcel ID: ${property.data.parcelNumber}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Tax Status: ${property.data.taxStatus === 'Paid' ? 'Current' : `DELINQUENT - $${property.data.amountOwed} Owed`}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Title Condition: ${analyzeTitleCondition(property.data.encumbrances)}`, 20, yPosition);
                yPosition += 15;

                // Chain of Title
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('Chain of Title', 20, yPosition);
                yPosition += 10;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                
                property.data.ownershipChain.forEach((entry, index) => {
                    if (yPosition > pageHeight - 30) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(`${index + 1}. ${entry.owner} from ${entry.from} (${entry.deedType}, ${entry.date})`, 20, yPosition);
                    yPosition += 6;
                });

                yPosition += 10;
                doc.setFont('helvetica', 'bold');
                doc.text('Chain Analysis:', 20, yPosition);
                yPosition += 6;
                doc.setFont('helvetica', 'normal');
                const analysisLines = doc.splitTextToSize(analyzeChainOfTitle(property.data.ownershipChain), pageWidth - 40);
                doc.text(analysisLines, 20, yPosition);
            }

            doc.save(`title-report-${address.replace(/[^a-zA-Z0-9]/g, '-')}.pdf`);
        }

        // Advanced Error Handling & Analytics
        class TitleGuardAnalytics {
            constructor() {
                this.sessionId = this.generateSessionId();
                this.startTime = Date.now();
                this.trackEvent('app_loaded');
            }
            
            generateSessionId() {
                return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            trackEvent(eventName, properties = {}) {
                const event = {
                    sessionId: this.sessionId,
                    event: eventName,
                    timestamp: new Date().toISOString(),
                    properties: properties,
                    userAgent: navigator.userAgent,
                    url: window.location.href
                };
                
                // Store in localStorage for analytics
                const events = JSON.parse(localStorage.getItem('tg_events') || '[]');
                events.push(event);
                localStorage.setItem('tg_events', JSON.stringify(events.slice(-100))); // Keep last 100 events
                
                console.log('Analytics Event:', event);
            }
            
            trackSearch(address, success, duration) {
                this.trackEvent('search_performed', {
                    address: address,
                    success: success,
                    duration: duration,
                    timestamp: Date.now() - this.startTime
                });
            }
            
            trackSearch(searchInput, success, duration, searchType) {
                this.trackEvent('search_performed', {
                    searchInput: searchInput,
                    searchType: searchType,
                    success: success,
                    duration: duration,
                    timestamp: Date.now() - this.startTime
                });
            }
        }
        
        const analytics = new TitleGuardAnalytics();
        
        // Advanced Search Features
        class AdvancedSearch {
            constructor() {
                this.setupSearchTypeToggle();
                this.setupAddressAutocomplete();
                this.setupAdvancedOptions();
                this.setupRealTimeValidation();
            }
            
            setupSearchTypeToggle() {
                const searchTypeRadios = document.querySelectorAll('input[name="searchType"]');
                const searchLabel = document.getElementById('searchLabel');
                const searchInput = document.getElementById('searchInput');
                const searchIcon = document.getElementById('searchIcon');
                
                searchTypeRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        this.updateSearchInterface(radio.value);
                    });
                });
            }
            
            updateSearchInterface(searchType) {
                const searchLabel = document.getElementById('searchLabel');
                const searchInput = document.getElementById('searchInput');
                const searchIcon = document.getElementById('searchIcon');
                
                switch (searchType) {
                    case 'address':
                        searchLabel.textContent = 'Property Address';
                        searchInput.placeholder = 'Enter property address (e.g., 123 Main St, Anytown, USA)';
                        searchInput.setAttribute('autocomplete', 'address-line1');
                        searchIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />';
                        break;
                case 'tax':
                    searchLabel.textContent = 'Tax ID / Parcel Number';
                    searchInput.placeholder = 'Enter Tax ID or Parcel Number (e.g., R12345-001-002)';
                    searchInput.setAttribute('autocomplete', 'off');
                    searchIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />';
                    break;
                }
                
                // Clear input and suggestions
                searchInput.value = '';
                document.getElementById('searchSuggestions').classList.add('hidden');
                document.getElementById('searchValidation').innerHTML = '';
            }
            
            setupAddressAutocomplete() {
                const searchInput = document.getElementById('searchInput');
                const suggestionsDiv = document.getElementById('searchSuggestions');
                
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const searchType = document.querySelector('input[name="searchType"]:checked').value;
                    
                    if (query.length < 2) {
                        suggestionsDiv.classList.add('hidden');
                        return;
                    }
                    
                    const suggestions = this.getSearchSuggestions(query, searchType);
                    this.displaySuggestions(suggestions, searchType);
                });
                
                // Hide suggestions when clicking outside
                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                        suggestionsDiv.classList.add('hidden');
                    }
                });
            }
            
            getSearchSuggestions(query, searchType) {
                const suggestions = [];
                
                for (const [address, data] of Object.entries(mockProperties)) {
                    switch (searchType) {
                        case 'address':
                            if (address.toLowerCase().includes(query)) {
                                suggestions.push({ type: 'address', value: address, display: address });
                            }
                            break;
                        case 'tax':
                            // Search both parcel number and tax ID
                            if (data.parcelNumber.toLowerCase().includes(query) || 
                                (data.taxId && data.taxId.toLowerCase().includes(query))) {
                                suggestions.push({ 
                                    type: 'tax', 
                                    value: data.parcelNumber, // Use parcel number as primary identifier
                                    display: `${data.parcelNumber} - ${address}` 
                                });
                            }
                            break;
                    }
                }
                
                return suggestions.slice(0, 5);
            }
            
            displaySuggestions(suggestions, searchType) {
                const suggestionsDiv = document.getElementById('searchSuggestions');
                
                if (suggestions.length === 0) {
                    suggestionsDiv.classList.add('hidden');
                    return;
                }
                
                const iconMap = {
                    address: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />',
                    tax: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />'
                };
                
                suggestionsDiv.innerHTML = suggestions.map(suggestion => `
                    <div class="px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0" onclick="selectSuggestion('${suggestion.value}', '${suggestion.type}')">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                ${iconMap[suggestion.type]}
                            </svg>
                            <span class="text-sm text-gray-700">${suggestion.display}</span>
                        </div>
                    </div>
                `).join('');
                
                suggestionsDiv.classList.remove('hidden');
            }
            
            setupAdvancedOptions() {
                const toggleBtn = document.getElementById('toggleAdvanced');
                const optionsDiv = document.getElementById('advancedOptions');
                const toggleText = document.getElementById('toggleText');
                const toggleIcon = document.getElementById('toggleIcon');
                
                toggleBtn.addEventListener('click', () => {
                    const isHidden = optionsDiv.classList.contains('hidden');
                    
                    if (isHidden) {
                        optionsDiv.classList.remove('hidden');
                        toggleText.textContent = 'Hide Options';
                        toggleIcon.style.transform = 'rotate(180deg)';
                    } else {
                        optionsDiv.classList.add('hidden');
                        toggleText.textContent = 'Show Options';
                        toggleIcon.style.transform = 'rotate(0deg)';
                    }
                });
            }
            
            setupRealTimeValidation() {
                const searchInput = document.getElementById('searchInput');
                const validationDiv = document.getElementById('searchValidation');
                
                searchInput.addEventListener('input', () => {
                    const searchType = document.querySelector('input[name="searchType"]:checked').value;
                    const validation = validateSearchInput(searchInput.value, searchType);
                    this.displayValidation(validation, validationDiv);
                });
            }
            
            displayValidation(validation, container) {
                if (validation.isValid) {
                    container.innerHTML = '<div class="flex items-center text-green-600"><svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>Valid address format</div>';
                } else {
                    container.innerHTML = validation.errors.map(error => 
                        `<div class="flex items-center text-red-600"><svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>${error}</div>`
                    ).join('');
                }
            }
        }
        
        // Initialize advanced search features
        const advancedSearch = new AdvancedSearch();
        
        // Global function for suggestion selection
        window.selectSuggestion = function(value, type) {
            document.getElementById('searchInput').value = value;
            document.getElementById('searchSuggestions').classList.add('hidden');
            analytics.trackEvent('search_suggestion_selected', { value: value, type: type });
        };
        
        // Advanced Error Handling
        class ErrorHandler {
            static showError(message, type = 'error') {
                const errorContainer = document.getElementById('errorContainer') || this.createErrorContainer();
                
                const errorElement = document.createElement('div');
                errorElement.className = `fixed top-4 right-4 z-50 max-w-md p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full ${
                    type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' : 
                    type === 'warning' ? 'bg-yellow-50 border border-yellow-200 text-yellow-800' :
                    'bg-blue-50 border border-blue-200 text-blue-800'
                }`;
                
                errorElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                        <div class="ml-4 flex-shrink-0">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                                <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                
                errorContainer.appendChild(errorElement);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (errorElement.parentElement) {
                        errorElement.style.transform = 'translateX(100%)';
                        setTimeout(() => errorElement.remove(), 300);
                    }
                }, 5000);
                
                // Show immediately
                setTimeout(() => {
                    errorElement.style.transform = 'translateX(0)';
                }, 100);
            }
            
            static createErrorContainer() {
                const container = document.createElement('div');
                container.id = 'errorContainer';
                container.className = 'fixed top-4 right-4 z-50 space-y-2';
                document.body.appendChild(container);
                return container;
            }
        }
        
        // Enhanced Form Validation
        function validateSearchInput(input, searchType) {
            const errors = [];
            const trimmedInput = input.trim();
            
            if (!trimmedInput) {
                errors.push(`Please enter a ${searchType === 'address' ? 'property address' : 'tax ID or parcel number'}`);
                return { isValid: false, errors };
            }
            
            switch (searchType) {
                case 'address':
                    if (trimmedInput.length < 5) {
                        errors.push('Address must be at least 5 characters long');
                    } else if (!/^[a-zA-Z0-9\s,.-]+$/.test(trimmedInput)) {
                        errors.push('Address contains invalid characters');
                    }
                    break;
                    
                case 'tax':
                    if (!/^[A-Z0-9-]+$/i.test(trimmedInput)) {
                        errors.push('Tax ID/Parcel Number must contain only letters, numbers, and hyphens');
                    } else if (trimmedInput.length < 3) {
                        errors.push('Tax ID/Parcel Number must be at least 3 characters long');
                    }
                    break;
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }
        
        // Legacy function for backward compatibility
        function validateAddress(address) {
            return validateSearchInput(address, 'address');
        }
        
        // Enhanced Search with Progress Tracking
        function performSearch(searchInput, searchType) {
            const startTime = Date.now();
            
            return new Promise((resolve, reject) => {
                // Simulate realistic search phases based on search type
                const phases = searchType === 'address' ? [
                    { name: 'Connecting to databases...', duration: 500 },
                    { name: 'Retrieving property information...', duration: 800 },
                    { name: 'Analyzing chain of title...', duration: 1000 },
                    { name: 'Searching encumbrances...', duration: 700 },
                    { name: 'Generating report...', duration: 500 }
                ] : [
                    { name: 'Connecting to tax/assessor database...', duration: 400 },
                    { name: 'Looking up tax ID/parcel information...', duration: 600 },
                    { name: 'Retrieving property details...', duration: 500 },
                    { name: 'Analyzing chain of title...', duration: 1000 },
                    { name: 'Searching encumbrances...', duration: 700 },
                    { name: 'Generating report...', duration: 500 }
                ];
                
                let currentPhase = 0;
                
                function updateProgress() {
                    if (currentPhase < phases.length) {
                        const phase = phases[currentPhase];
                        updateSearchButton(`${phase.name}`, true);
                        
                        setTimeout(() => {
                            currentPhase++;
                            updateProgress();
                        }, phase.duration);
                    } else {
                        const property = findPropertyBySearchInput(searchInput, searchType);
                        const duration = Date.now() - startTime;
                        
                        if (property) {
                            analytics.trackSearch(searchInput, true, duration, searchType);
                            resolve({ property, duration });
                        } else {
                            analytics.trackSearch(searchInput, false, duration, searchType);
                            reject(new Error('Property not found'));
                        }
                    }
                }
                
                updateProgress();
            });
        }
        
        function updateSearchButton(text, isLoading) {
            const searchBtn = document.getElementById('searchBtn');
            if (isLoading) {
                searchBtn.innerHTML = `
                    <svg class="h-5 w-5 animate-spin mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span>${text}</span>
                `;
                searchBtn.disabled = true;
            } else {
                searchBtn.innerHTML = `
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span>Search Title</span>
                `;
                searchBtn.disabled = false;
            }
        }
        
        // Enhanced Form Submission Handler
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const searchInput = document.getElementById('searchInput').value.trim();
            const searchType = document.querySelector('input[name="searchType"]:checked').value;
            
            // Validate input
            const validation = validateSearchInput(searchInput, searchType);
            if (!validation.isValid) {
                validation.errors.forEach(error => {
                    ErrorHandler.showError(error, 'error');
                });
                return;
            }
            
            try {
                const result = await performSearch(searchInput, searchType);
                const { property, duration } = result;
                
                // Generate and display report
                const reportHTML = generateReportHTML(property.data, property.address);
                document.getElementById('reportDisplay').innerHTML = reportHTML;
                document.getElementById('reportDisplay').classList.remove('hidden');
                
                // Smooth scroll to report
                document.getElementById('reportDisplay').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Show success message
                ErrorHandler.showError(`Search completed successfully in ${(duration/1000).toFixed(1)}s`, 'success');
                
            } catch (error) {
                const testExamples = searchType === 'address' ? 
                    'â€¢ 123 Main St, Anytown, USA\nâ€¢ 456 Oak Avenue, Springfield, IL' :
                    'â€¢ R12345-001-002\nâ€¢ R67890-003-001';
                
                ErrorHandler.showError(
                    `Property not found. Please try one of the test ${searchType === 'address' ? 'addresses' : 'tax IDs/parcel numbers'}:\n${testExamples}`,
                    'warning'
                );
            }
        });
    </script>
</body>
</html>
