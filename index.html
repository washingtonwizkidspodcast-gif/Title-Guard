<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TitleGuard AI - Title Search Assistant</title>
    <meta name="description" content="Digital Title Abstractor and Real Estate Data Analyst - Comprehensive preliminary title search tool">
    <meta name="keywords" content="title search, real estate, property search, title abstractor, real estate data">
    <meta name="author" content="TitleGuard AI">
    
    <!-- Accessibility -->
    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" content="#667eea">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TitleGuard AI">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://title-guard.netlify.app/">
    <meta property="og:title" content="TitleGuard AI - Title Search Assistant">
    <meta property="og:description" content="Digital Title Abstractor and Real Estate Data Analyst">
    <meta property="og:image" content="https://title-guard.netlify.app/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://title-guard.netlify.app/">
    <meta property="twitter:title" content="TitleGuard AI - Title Search Assistant">
    <meta property="twitter:description" content="Digital Title Abstractor and Real Estate Data Analyst">
    <meta property="twitter:image" content="https://title-guard.netlify.app/og-image.png">

    <!-- Performance Optimizations -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
    <!-- Critical CSS -->
    <style>
        /* Critical above-the-fold styles */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .loading-skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Service Worker for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
    <style>
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Modern gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Glass morphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Modern shadows */
        .shadow-modern {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .shadow-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Smooth animations */
        .transition-all {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Modern button hover effects */
        .btn-modern {
            position: relative;
            overflow: hidden;
        }
        
        .btn-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-modern:hover::before {
            left: 100%;
        }
        
        /* Card hover effects */
        .card-hover {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        /* Modern input focus */
        .input-modern:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            border-color: #667eea;
        }
        
        /* Status indicators */
        .status-clear {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .status-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .status-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full mb-6">
                    <svg class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h1 class="text-5xl font-bold text-white mb-4">TitleGuard AI</h1>
                <p class="text-xl text-white text-opacity-90 mb-6">Digital Title Abstractor and Real Estate Data Analyst</p>
                <div class="inline-flex items-center px-4 py-2 bg-white bg-opacity-20 rounded-full text-white text-sm font-medium">
                    <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    Powered by Advanced AI Technology
                </div>
            </div>
        </div>
        <!-- Decorative elements -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
            <div class="absolute -top-40 -right-40 w-80 h-80 bg-white bg-opacity-5 rounded-full"></div>
            <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-white bg-opacity-5 rounded-full"></div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div id="app">
            <!-- Search Form -->
            <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 mb-8 card-hover">
                <div class="w-full max-w-2xl mx-auto">
                    <div class="text-center mb-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Start Your Title Search</h2>
                        <p class="text-gray-600">Enter a property address to begin comprehensive title analysis</p>
                    </div>
                    
                    <form id="searchForm" class="space-y-6">
                        <!-- Property Address Search -->
                        <div class="space-y-4">
                            <div>
                                <label for="addressInput" class="block text-sm font-semibold text-gray-700 mb-3">
                                    Property Address
                                </label>
                                <div class="relative">
                                    <input
                                        type="text"
                                        id="addressInput"
                                        name="addressInput"
                                        placeholder="Enter property address (e.g., 123 Main St, Anytown, USA)"
                                        class="input-modern w-full px-6 py-4 pl-14 pr-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-transparent outline-none transition-all duration-300 text-lg"
                                        autocomplete="address-line1"
                                        spellcheck="false"
                                    />
                                    <svg class="absolute left-5 top-1/2 transform -translate-y-1/2 h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                    <div id="addressSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden mt-1 max-h-60 overflow-y-auto"></div>
                                </div>
                                <div id="addressValidation" class="mt-2 text-sm"></div>
                            </div>
                        </div>

                        <!-- Tax ID/Parcel Number Search -->
                        <div class="space-y-4">
                            <div>
                                <label for="taxIdInput" class="block text-sm font-semibold text-gray-700 mb-3">
                                    Tax ID / Parcel Number
                                </label>
                                <div class="relative">
                                    <input
                                        type="text"
                                        id="taxIdInput"
                                        name="taxIdInput"
                                        placeholder="Enter Tax ID or Parcel Number (e.g., R12345-001-002)"
                                        class="input-modern w-full px-6 py-4 pl-14 pr-4 border-2 border-gray-200 rounded-xl focus:ring-0 focus:border-transparent outline-none transition-all duration-300 text-lg"
                                        autocomplete="off"
                                        spellcheck="false"
                                    />
                                    <svg class="absolute left-5 top-1/2 transform -translate-y-1/2 h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                    </svg>
                                    <div id="taxIdSuggestions" class="absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-lg shadow-lg z-10 hidden mt-1 max-h-60 overflow-y-auto"></div>
                                </div>
                                <div id="taxIdValidation" class="mt-2 text-sm"></div>
                            </div>
                        </div>
                        
                        <button
                            type="submit"
                            id="searchBtn"
                            class="btn-modern w-full gradient-bg hover:shadow-glow text-white font-semibold py-4 px-8 rounded-xl transition-all duration-300 flex items-center justify-center space-x-3 text-lg"
                        >
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <span>Search Title</span>
                        </button>
                    </form>
                    
                    <div class="mt-8 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-100">
                        <p class="font-semibold text-gray-800 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Test Properties Available
                        </p>
                        <div class="space-y-3">
                            <!-- Property 1 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center mb-2">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-3"></div>
                                    <span class="font-medium text-gray-800">Property 1: Clear Title</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        </svg>
                                        <span class="text-gray-600">123 Main St, Anytown, USA</span>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <span class="text-gray-600">Tax ID: R12345-001-002</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Property 2 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center mb-2">
                                    <div class="w-2 h-2 bg-orange-500 rounded-full mr-3"></div>
                                    <span class="font-medium text-gray-800">Property 2: Issues Found</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        </svg>
                                        <span class="text-gray-600">456 Oak Avenue, Springfield, IL</span>
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="w-3 h-3 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <span class="text-gray-600">Tax ID: R67890-003-001</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 border border-blue-200 rounded-2xl p-8 mb-8 card-hover">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">How TitleGuard AI Works</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="flex items-start space-x-3">
                                    <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
                                    <p class="text-gray-700 font-medium">Enter a property address in the search field above</p>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</div>
                                    <p class="text-gray-700 font-medium">AI performs comprehensive analysis including:</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Property ownership verification</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">50-year chain of title analysis</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Encumbrance and lien search</span>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                    <span class="text-gray-700">Tax status verification</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex items-center space-x-3">
                            <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</div>
                            <p class="text-gray-700 font-medium">Review the generated preliminary title report</p>
                        </div>
                        <div class="mt-3 flex items-center space-x-3">
                            <div class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold">4</div>
                            <p class="text-gray-700 font-medium">Export the report as PDF for your records</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Display (Hidden Initially) -->
            <div id="reportDisplay" class="hidden">
                <!-- Report content will be generated here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-white bg-opacity-20 rounded-full mb-4">
                    <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">TitleGuard AI</h3>
                <p class="text-white text-opacity-80 mb-6">Automated Title Search Assistant</p>
                <p class="text-white text-opacity-70 text-sm mb-6 max-w-2xl mx-auto">
                    This tool is for informational purposes only and does not provide legal advice or title insurance. 
                    All findings must be verified by qualified professionals before any real estate transaction.
                </p>
                <div class="flex justify-center space-x-6">
                    <a href="https://github.com/washingtonwizkidspodcast-gif/Title-Guard" class="text-white text-opacity-80 hover:text-opacity-100 transition-all duration-300 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                        <span>GitHub</span>
                    </a>
                    <span class="text-white text-opacity-50">â€¢</span>
                    <a href="https://netlify.com" class="text-white text-opacity-80 hover:text-opacity-100 transition-all duration-300 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6.5 0C2.91 0 0 2.91 0 6.5c0 1.77.74 3.37 1.93 4.5L12 23l10.07-12c1.19-1.13 1.93-2.73 1.93-4.5C24 2.91 21.09 0 17.5 0S11 2.91 11 6.5c0 .5.07 1 .2 1.47L12 12l.8-4.03c.13-.47.2-.97.2-1.47C13 2.91 10.09 0 6.5 0z"/>
                        </svg>
                        <span>Netlify</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Enhanced mock data for professional-grade title reports
        const mockProperties = {
            "123 Main St, Anytown, USA": {
                parcelNumber: "R12345-001-002",
                taxId: "TX-12345-001",
                currentOwner: "John Doe and Jane Doe",
                ownershipType: "Fee Simple",
                legalDescription: "LOT 1, BLOCK 2, ANYTOWN ESTATES, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 15, PAGE 42, OF THE PUBLIC RECORDS OF ANYCOUNTY, USA.",
                propertySitus: "123 Main St, Anytown, USA",
                county: "AnyCounty",
                state: "USA",
                zipCode: "12345",
                searchScope: "50 Years (1974-2024)",
                searchDate: new Date().toISOString().split('T')[0],
                
                // Schedule A: Property and Ownership Information
                scheduleA: {
                    propertyAddress: "123 Main St, Anytown, USA",
                    legalDescription: "LOT 1, BLOCK 2, ANYTOWN ESTATES, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 15, PAGE 42, OF THE PUBLIC RECORDS OF ANYCOUNTY, USA.",
                    currentOwner: "John Doe and Jane Doe",
                    ownershipType: "Fee Simple",
                    estateType: "Fee Simple Absolute",
                    vestingDate: "2023-05-15",
                    vestingDocument: "Warranty Deed #2023-00456"
                },
                
                // Schedule B: Exceptions and Encumbrances
                scheduleB: {
                    liens: [
                        { type: "Mortgage", parties: ["John Doe and Jane Doe", "Big Bank Inc."], date: "2023-05-15", docNum: "2023-00457", status: "Open", amount: "$350,000", priority: "First" },
                        { type: "Federal Tax Lien", parties: ["IRS", "Emily Investor"], date: "2012-08-01", docNum: "2012-00987", status: "Released", amount: "$15,200", releaseDate: "2013-02-15", releaseDoc: "2023-00123" }
                    ],
                    easements: [
                        { type: "Utility Easement", parties: ["Electric Company"], date: "2010-05-15", docNum: "2010-00189", status: "Active", description: "Grants access to the rear 10 feet of the property for utility maintenance", width: "10 feet", location: "Rear property line" },
                        { type: "Drainage Easement", parties: ["City of Anytown"], date: "2008-03-20", docNum: "2008-00234", status: "Active", description: "Storm water drainage easement", width: "5 feet", location: "North side" }
                    ],
                    restrictions: [
                        { type: "HOA Covenants", parties: ["Anytown Estates HOA"], date: "2005-01-15", docNum: "2005-00045", status: "Active", description: "Homeowners Association bylaws and restrictions", monthlyFee: "$150" },
                        { type: "Zoning Restriction", parties: ["City of Anytown"], date: "2000-06-01", docNum: "2000-00345", status: "Active", description: "Single-family residential zoning", setbacks: "25 feet front, 10 feet sides, 15 feet rear" }
                    ],
                    judgments: [],
                    pendingActions: []
                },
                
                // Schedule C: Legal Description and Jurisdiction
                scheduleC: {
                    legalDescription: "LOT 1, BLOCK 2, ANYTOWN ESTATES, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 15, PAGE 42, OF THE PUBLIC RECORDS OF ANYCOUNTY, USA.",
                    lotNumber: "1",
                    blockNumber: "2",
                    subdivision: "Anytown Estates",
                    platBook: "15",
                    platPage: "42",
                    township: "T1N",
                    range: "R2E",
                    section: "12",
                    county: "AnyCounty",
                    state: "USA",
                    zoning: "R-1 (Single Family Residential)",
                    zoningRestrictions: "Single-family dwelling, minimum 2,000 sq ft, maximum height 35 feet"
                },
                
                // Enhanced Chain of Title
                ownershipChain: [
                    { owner: "John Doe and Jane Doe", from: "Robert Seller", deedType: "Warranty Deed", date: "2023-05-15", docNum: "2023-00456", consideration: "$425,000", vesting: "Joint Tenants with Right of Survivorship" },
                    { owner: "Robert Seller", from: "Emily Investor", deedType: "Grant Deed", date: "2010-03-22", docNum: "2010-00123", consideration: "$285,000", vesting: "Fee Simple" },
                    { owner: "Emily Investor", from: "Historic Holdings LLC", deedType: "Warranty Deed", date: "1995-08-10", docNum: "1995-00567", consideration: "$125,000", vesting: "Fee Simple" },
                    { owner: "Historic Holdings LLC", from: "Margaret Johnson", deedType: "Quitclaim Deed", date: "1978-12-05", docNum: "1978-00890", consideration: "$45,000", vesting: "Fee Simple" },
                    { owner: "Margaret Johnson", from: "William Johnson", deedType: "Warranty Deed", date: "1965-04-18", docNum: "1965-00234", consideration: "$12,500", vesting: "Fee Simple" }
                ],
                
                // Current Owner Mortgage Information
                currentMortgage: {
                    hasActiveMortgage: true,
                    mortgageDetails: {
                        lender: "Big Bank Inc.",
                        loanNumber: "BB-2023-00457",
                        originalLoanAmount: "$350,000",
                        currentBalance: "$342,500",
                        interestRate: "6.25%",
                        loanType: "Conventional Fixed Rate",
                        termLength: "30 years",
                        monthlyPayment: "$2,156.25",
                        loanToValueRatio: "80.6%",
                        downPayment: "$75,000",
                        originationDate: "2023-05-15",
                        maturityDate: "2053-05-15",
                        remainingTerm: "29 years, 4 months",
                        paymentFrequency: "Monthly",
                        escrowAccount: true,
                        escrowAmount: "$358.33",
                        principalAndInterest: "$1,797.92",
                        propertyInsurance: "$125.00",
                        propertyTaxes: "$354.17",
                        totalMonthlyPayment: "$2,514.58",
                        lastPaymentDate: "2024-01-15",
                        nextPaymentDue: "2024-02-15",
                        paymentStatus: "Current",
                        daysPastDue: 0,
                        lateFees: "$0.00",
                        prepaymentPenalty: false,
                        assumable: false,
                        refinanceHistory: [],
                        modificationHistory: []
                    },
                    mortgageDocuments: [
                        { type: "Mortgage Deed", docNum: "2023-00457", date: "2023-05-15", status: "Active" },
                        { type: "Promissory Note", docNum: "2023-00458", date: "2023-05-15", status: "Active" },
                        { type: "Deed of Trust", docNum: "2023-00459", date: "2023-05-15", status: "Active" }
                    ],
                    mortgageAnalysis: {
                        riskLevel: "Low",
                        equityPosition: "19.4%",
                        monthlyIncomeRatio: "28.5%",
                        debtToIncomeRatio: "35.2%",
                        creditScoreAtOrigination: "750",
                        appraisalValue: "$425,000",
                        appraisalDate: "2023-05-01",
                        appraisalCompany: "Professional Appraisal Services LLC"
                    }
                },
                
                // Tax Information
                taxInformation: {
                    currentStatus: "Paid",
                    amountOwed: "0.00",
                    lastPaymentDate: "2024-01-15",
                    annualTaxAmount: "$4,250.00",
                    assessmentValue: "$425,000",
                    taxYear: "2024",
                    exemptions: ["Homestead Exemption"],
                    taxLiens: "None",
                    specialAssessments: []
                },
                
                // Title Insurance Information
                titleInsurance: {
                    existingPolicies: [
                        { company: "Big Bank Title Insurance", policyNumber: "BTI-2023-00457", amount: "$350,000", date: "2023-05-15", type: "Lender's Policy" }
                    ],
                    claimsHistory: "No known claims",
                    titleDefects: "None identified"
                },
                
                // Property Information
                propertyInfo: {
                    lotSize: "0.25 acres",
                    squareFootage: "2,400 sq ft",
                    bedrooms: "4",
                    bathrooms: "3",
                    yearBuilt: "1995",
                    constructionType: "Frame",
                    foundation: "Concrete Slab",
                    roofType: "Asphalt Shingle",
                    heatingCooling: "Central Air/Heat",
                    utilities: "Public Water, Public Sewer, Natural Gas, Electric"
                },
                
                // Market Information
                marketInfo: {
                    estimatedValue: "$425,000",
                    lastSalePrice: "$425,000",
                    lastSaleDate: "2023-05-15",
                    pricePerSqFt: "$177.08",
                    comparableSales: "3 sales within 0.5 miles in last 12 months"
                }
            },
            "456 Oak Avenue, Springfield, IL": {
                parcelNumber: "R67890-003-001",
                taxId: "TX-67890-003",
                currentOwner: "Sarah Williams",
                ownershipType: "Fee Simple",
                legalDescription: "LOT 3, BLOCK 1, OAK GROVE SUBDIVISION, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 8, PAGE 15, OF THE PUBLIC RECORDS OF SPRINGFIELD COUNTY, ILLINOIS.",
                propertySitus: "456 Oak Avenue, Springfield, IL",
                county: "Springfield County",
                state: "Illinois",
                zipCode: "62701",
                searchScope: "50 Years (1974-2024)",
                searchDate: new Date().toISOString().split('T')[0],
                
                // Schedule A: Property and Ownership Information
                scheduleA: {
                    propertyAddress: "456 Oak Avenue, Springfield, IL",
                    legalDescription: "LOT 3, BLOCK 1, OAK GROVE SUBDIVISION, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 8, PAGE 15, OF THE PUBLIC RECORDS OF SPRINGFIELD COUNTY, ILLINOIS.",
                    currentOwner: "Sarah Williams",
                    ownershipType: "Fee Simple",
                    estateType: "Fee Simple Absolute",
                    vestingDate: "2021-09-12",
                    vestingDocument: "Warranty Deed #2021-00789"
                },
                
                // Schedule B: Exceptions and Encumbrances
                scheduleB: {
                    liens: [
                        { type: "Mortgage", parties: ["Sarah Williams", "First National Bank"], date: "2021-09-12", docNum: "2021-00790", status: "Open", amount: "$280,000", priority: "First" },
                        { type: "HOA Lien", parties: ["Oak Grove HOA", "Sarah Williams"], date: "2023-01-15", docNum: "2023-00045", status: "Open", amount: "$2,400", priority: "Second" },
                        { type: "Mechanic's Lien", parties: ["ABC Construction", "Linda Davis"], date: "1990-05-20", docNum: "1990-00123", status: "Open", amount: "$8,500", priority: "Third" },
                        { type: "Federal Tax Lien", parties: ["IRS", "Sarah Williams"], date: "2022-01-15", docNum: "2022-00089", status: "Open", amount: "$12,500", priority: "Fourth" }
                    ],
                    easements: [
                        { type: "Utility Easement", parties: ["Springfield Electric"], date: "2005-08-10", docNum: "2005-00345", status: "Active", description: "Overhead power line easement", width: "15 feet", location: "East side" },
                        { type: "Sewer Easement", parties: ["Springfield Sewer District"], date: "2000-12-01", docNum: "2000-00789", status: "Active", description: "Sewer line maintenance easement", width: "8 feet", location: "South side" }
                    ],
                    restrictions: [
                        { type: "HOA Covenants", parties: ["Oak Grove HOA"], date: "2000-03-15", docNum: "2000-00123", status: "Active", description: "Homeowners Association bylaws and architectural restrictions", monthlyFee: "$125" },
                        { type: "Zoning Restriction", parties: ["City of Springfield"], date: "1995-06-01", docNum: "1995-00456", status: "Active", description: "Single-family residential zoning", setbacks: "30 feet front, 15 feet sides, 20 feet rear" }
                    ],
                    judgments: [
                        { type: "Divorce Decree", parties: ["Sarah Williams", "Ex-Spouse"], date: "2020-08-15", docNum: "2020-00567", status: "Active", description: "Property division in divorce settlement", amount: "$50,000" }
                    ],
                    pendingActions: [
                        { type: "Foreclosure Notice", parties: ["First National Bank", "Sarah Williams"], date: "2024-01-20", docNum: "2024-00012", status: "Pending", description: "Notice of default on mortgage payments" }
                    ]
                },
                
                // Schedule C: Legal Description and Jurisdiction
                scheduleC: {
                    legalDescription: "LOT 3, BLOCK 1, OAK GROVE SUBDIVISION, ACCORDING TO THE PLAT THEREOF, AS RECORDED IN PLAT BOOK 8, PAGE 15, OF THE PUBLIC RECORDS OF SPRINGFIELD COUNTY, ILLINOIS.",
                    lotNumber: "3",
                    blockNumber: "1",
                    subdivision: "Oak Grove Subdivision",
                    platBook: "8",
                    platPage: "15",
                    township: "T2N",
                    range: "R3E",
                    section: "18",
                    county: "Springfield County",
                    state: "Illinois",
                    zoning: "R-2 (Single Family Residential)",
                    zoningRestrictions: "Single-family dwelling, minimum 1,800 sq ft, maximum height 30 feet"
                },
                
                // Enhanced Chain of Title
                ownershipChain: [
                    { owner: "Sarah Williams", from: "Michael Thompson", deedType: "Warranty Deed", date: "2021-09-12", docNum: "2021-00789", consideration: "$350,000", vesting: "Fee Simple" },
                    { owner: "Michael Thompson", from: "Linda Davis", deedType: "Grant Deed", date: "2005-11-30", docNum: "2005-00456", consideration: "$185,000", vesting: "Fee Simple" },
                    { owner: "Linda Davis", from: "James Davis", deedType: "Warranty Deed", date: "1988-07-14", docNum: "1988-00234", consideration: "$75,000", vesting: "Fee Simple" },
                    { owner: "James Davis", from: "Estate of Robert Davis", deedType: "Personal Representative Deed", date: "1972-03-08", docNum: "1972-00112", consideration: "$25,000", vesting: "Fee Simple" }
                ],
                
                // Current Owner Mortgage Information
                currentMortgage: {
                    hasActiveMortgage: true,
                    mortgageDetails: {
                        lender: "First National Bank",
                        loanNumber: "FNB-2021-00790",
                        originalLoanAmount: "$280,000",
                        currentBalance: "$268,750",
                        interestRate: "3.75%",
                        loanType: "Conventional Fixed Rate",
                        termLength: "30 years",
                        monthlyPayment: "$1,296.48",
                        loanToValueRatio: "80.0%",
                        downPayment: "$70,000",
                        originationDate: "2021-09-12",
                        maturityDate: "2051-09-12",
                        remainingTerm: "27 years, 8 months",
                        paymentFrequency: "Monthly",
                        escrowAccount: true,
                        escrowAmount: "$291.67",
                        principalAndInterest: "$1,004.81",
                        propertyInsurance: "$100.00",
                        propertyTaxes: "$291.67",
                        totalMonthlyPayment: "$1,588.15",
                        lastPaymentDate: "2023-12-15",
                        nextPaymentDue: "2024-01-15",
                        paymentStatus: "Delinquent",
                        daysPastDue: 45,
                        lateFees: "$75.00",
                        prepaymentPenalty: false,
                        assumable: false,
                        refinanceHistory: [],
                        modificationHistory: [
                            { type: "Payment Deferral", date: "2023-10-15", amount: "$1,588.15", status: "Active" }
                        ]
                    },
                    mortgageDocuments: [
                        { type: "Mortgage Deed", docNum: "2021-00790", date: "2021-09-12", status: "Active" },
                        { type: "Promissory Note", docNum: "2021-00791", date: "2021-09-12", status: "Active" },
                        { type: "Deed of Trust", docNum: "2021-00792", date: "2021-09-12", status: "Active" },
                        { type: "Modification Agreement", docNum: "2023-00123", date: "2023-10-15", status: "Active" }
                    ],
                    mortgageAnalysis: {
                        riskLevel: "High",
                        equityPosition: "23.2%",
                        monthlyIncomeRatio: "42.8%",
                        debtToIncomeRatio: "48.5%",
                        creditScoreAtOrigination: "680",
                        appraisalValue: "$350,000",
                        appraisalDate: "2021-09-01",
                        appraisalCompany: "Springfield Appraisal Group"
                    }
                },
                
                // Tax Information
                taxInformation: {
                    currentStatus: "Delinquent",
                    amountOwed: "3,247.50",
                    lastPaymentDate: "2023-01-15",
                    annualTaxAmount: "$3,500.00",
                    assessmentValue: "$350,000",
                    taxYear: "2024",
                    exemptions: [],
                    taxLiens: "Tax lien filed 2023-03-01, Document #2023-00156",
                    specialAssessments: [
                        { type: "Street Improvement", amount: "$1,200", dueDate: "2024-06-01", status: "Outstanding" }
                    ]
                },
                
                // Title Insurance Information
                titleInsurance: {
                    existingPolicies: [
                        { company: "First National Title Insurance", policyNumber: "FNTI-2021-00790", amount: "$280,000", date: "2021-09-12", type: "Lender's Policy" }
                    ],
                    claimsHistory: "No known claims",
                    titleDefects: "Multiple liens and encumbrances identified"
                },
                
                // Property Information
                propertyInfo: {
                    lotSize: "0.20 acres",
                    squareFootage: "1,950 sq ft",
                    bedrooms: "3",
                    bathrooms: "2",
                    yearBuilt: "1988",
                    constructionType: "Frame",
                    foundation: "Basement",
                    roofType: "Asphalt Shingle",
                    heatingCooling: "Central Air/Heat",
                    utilities: "Public Water, Public Sewer, Natural Gas, Electric"
                },
                
                // Market Information
                marketInfo: {
                    estimatedValue: "$350,000",
                    lastSalePrice: "$350,000",
                    lastSaleDate: "2021-09-12",
                    pricePerSqFt: "$179.49",
                    comparableSales: "2 sales within 0.5 miles in last 12 months"
                }
            }
        };

        // Find property by address
        function findPropertyByAddress(address) {
            const normalizedAddress = address.toLowerCase().trim();
            for (const [key, value] of Object.entries(mockProperties)) {
                if (key.toLowerCase().includes(normalizedAddress.split(',')[0]) || 
                    normalizedAddress.includes(key.toLowerCase().split(',')[0])) {
                    return { address: key, data: value };
                }
            }
            return null;
        }
        
        // Enhanced property lookup function for multiple search types
        function findPropertyBySearchInput(searchInput, searchType) {
            const normalizedInput = searchInput.toLowerCase().trim();
            
            for (const [key, value] of Object.entries(mockProperties)) {
                switch (searchType) {
                    case 'address':
                        if (key.toLowerCase().includes(normalizedInput.split(',')[0]) || 
                            normalizedInput.includes(key.toLowerCase().split(',')[0])) {
                            return { address: key, data: value };
                        }
                        break;
                    case 'tax':
                        // Search both parcel number and tax ID
                        if (value.parcelNumber.toLowerCase().includes(normalizedInput) ||
                            (value.taxId && value.taxId.toLowerCase().includes(normalizedInput))) {
                            return { address: key, data: value };
                        }
                        break;
                }
            }
            return null;
        }

        // Analyze title condition
        function analyzeTitleCondition(encumbrances) {
            const openMortgages = encumbrances.filter(e => e.status === 'Potentially Open' && e.type === 'Mortgage');
            const taxLiens = encumbrances.filter(e => e.status === 'Potentially Open' && e.type.includes('Tax Lien'));
            const otherLiens = encumbrances.filter(e => e.status === 'Potentially Open' && !e.type.includes('Mortgage') && !e.type.includes('Tax Lien'));

            if (openMortgages.length > 0 || taxLiens.length > 0 || otherLiens.length > 0) {
                return 'Significant Clouds Detected - Professional Review Required';
            } else if (encumbrances.length > 0) {
                return 'Exceptions Found';
            } else {
                return 'Appears Clear';
            }
        }

        // Analyze chain of title
        function analyzeChainOfTitle(chain) {
            const gaps = [];
            const defects = [];

            for (let i = 0; i < chain.length - 1; i++) {
                const current = chain[i];
                const next = chain[i + 1];
                
                if (current.from !== next.owner) {
                    gaps.push(`Gap detected between ${current.owner} and ${next.owner}`);
                }
            }

            chain.forEach(entry => {
                if (entry.deedType === 'Quitclaim Deed' && !entry.owner.includes('Estate') && !entry.from.includes('Estate')) {
                    defects.push(`Quitclaim deed used in non-familial transfer: ${entry.from} to ${entry.owner}`);
                }
            });

            if (gaps.length > 0 || defects.length > 0) {
                return `WARNING: Issues detected in chain of title. ${gaps.join('; ')} ${defects.join('; ')}`;
            } else {
                return 'Chain appears complete and unbroken back to 1970.';
            }
        }

        // Professional-grade report generation function
        function generateReportHTML(reportData, address) {
            const currentDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const titleCondition = analyzeTitleCondition(reportData.scheduleB?.liens || []);
            const chainAnalysis = analyzeChainOfTitle(reportData.ownershipChain);

            return `
                <div class="max-w-6xl mx-auto space-y-8">
                    <!-- Professional Report Header -->
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl shadow-modern p-8 text-white">
                        <div class="text-center">
                            <h1 class="text-3xl font-bold mb-2 flex items-center justify-center">
                                <svg class="h-10 w-10 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                PRELIMINARY TITLE REPORT
                            </h1>
                            <p class="text-blue-100 mb-2">TitleGuard AI - Professional Title Search</p>
                            <p class="text-blue-100 mb-4">Subject Property: ${address}</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-blue-200">Search Date:</span>
                                    <span class="font-semibold">${currentDate}</span>
                                </div>
                                <div>
                                    <span class="text-blue-200">Search Scope:</span>
                                    <span class="font-semibold">${reportData.searchScope || '50 Years'}</span>
                                </div>
                                <div>
                                    <span class="text-blue-200">Parcel ID:</span>
                                    <span class="font-semibold">${reportData.parcelNumber}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Critical Disclaimer -->
                        <div class="mt-6 p-4 bg-red-500 bg-opacity-20 border border-red-300 rounded-lg">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-red-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h3 class="text-sm font-medium text-red-100">CRITICAL DISCLAIMER</h3>
                                    <p class="text-sm text-red-100 mt-1">
                                        This is an informational, automated report based on a search of online public records. 
                                        It is NOT a substitute for a professional title examination or a policy of title insurance. 
                                        Data may be incomplete or inaccurate. All findings must be verified by a qualified 
                                        abstractor, attorney, or title company before any real estate transaction.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Buttons -->
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-6 card-hover">
                        <div class="flex flex-wrap gap-3">
                            <button onclick="exportToPDF('${address}')" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                                <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Export PDF
                            </button>
                        </div>
                    </div>

                    ${generateScheduleA(reportData.scheduleA, reportData)}
                    ${generateScheduleB(reportData.scheduleB)}
                    ${generateScheduleC(reportData.scheduleC)}
                    ${generateCurrentMortgage(reportData.currentMortgage)}
                    ${generateChainOfTitle(reportData.ownershipChain)}
                    ${generateTaxInformation(reportData.taxInformation)}
                    ${generateTitleInsurance(reportData.titleInsurance)}
                    ${generatePropertyInfo(reportData.propertyInfo)}
                    ${generateMarketInfo(reportData.marketInfo)}
                </div>
            `;
        }

        // Current Owner Mortgage Information
        function generateCurrentMortgage(currentMortgage) {
            if (!currentMortgage || !currentMortgage.hasActiveMortgage) {
                return `
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                        <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z" />
                            </svg>
                            Current Owner Mortgage Information
                        </h2>
                        <div class="text-center py-8">
                            <svg class="h-16 w-16 text-green-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">No Active Mortgage</h3>
                            <p class="text-gray-600">Property is owned free and clear</p>
                        </div>
                    </div>
                `;
            }

            const mortgage = currentMortgage.mortgageDetails;
            const analysis = currentMortgage.mortgageAnalysis;
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z" />
                        </svg>
                        Current Owner Mortgage Information
                    </h2>
                    
                    <!-- Mortgage Status Alert -->
                    <div class="mb-6 p-4 rounded-lg ${mortgage.paymentStatus === 'Current' ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}">
                        <div class="flex items-center">
                            <svg class="h-5 w-5 ${mortgage.paymentStatus === 'Current' ? 'text-green-600' : 'text-red-600'} mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <div>
                                <h3 class="text-sm font-medium ${mortgage.paymentStatus === 'Current' ? 'text-green-800' : 'text-red-800'}">
                                    Payment Status: ${mortgage.paymentStatus}
                                </h3>
                                ${mortgage.paymentStatus !== 'Current' ? `
                                    <p class="text-sm ${mortgage.paymentStatus === 'Current' ? 'text-green-700' : 'text-red-700'}">
                                        ${mortgage.daysPastDue} days past due | Late fees: ${mortgage.lateFees}
                                    </p>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- Mortgage Details Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Lender</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.lender}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Loan Number</label>
                                <p class="text-lg font-mono text-gray-900">${mortgage.loanNumber}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Original Loan Amount</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.originalLoanAmount}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Current Balance</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.currentBalance}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Interest Rate</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.interestRate}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Loan Type</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.loanType}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Term Length</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.termLength}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Remaining Term</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.remainingTerm}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Monthly Payment</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.monthlyPayment}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Total Monthly Payment</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.totalMonthlyPayment}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Loan-to-Value Ratio</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.loanToValueRatio}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Down Payment</label>
                                <p class="text-lg font-semibold text-gray-900">${mortgage.downPayment}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Breakdown -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Monthly Payment Breakdown</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-600">Principal & Interest</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.principalAndInterest}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-600">Property Insurance</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.propertyInsurance}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-600">Property Taxes</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.propertyTaxes}</span>
                                </div>
                                <div class="border-t border-gray-200 pt-2 mt-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-600">Total Monthly Payment</span>
                                        <span class="text-sm font-bold text-gray-900">${mortgage.totalMonthlyPayment}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-600">Last Payment Date</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.lastPaymentDate}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-600">Next Payment Due</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.nextPaymentDue}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm font-medium text-gray-600">Escrow Account</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.escrowAccount ? 'Yes' : 'No'}</span>
                                </div>
                                ${mortgage.escrowAccount ? `
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm font-medium text-gray-600">Escrow Amount</span>
                                        <span class="text-sm font-semibold text-gray-900">${mortgage.escrowAmount}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- Mortgage Analysis -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Mortgage Analysis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Risk Level</span>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${analysis.riskLevel === 'Low' ? 'bg-green-100 text-green-800' : analysis.riskLevel === 'Medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                        ${analysis.riskLevel}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Equity Position</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.equityPosition}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Monthly Income Ratio</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.monthlyIncomeRatio}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Debt-to-Income Ratio</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.debtToIncomeRatio}</span>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Credit Score (Origination)</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.creditScoreAtOrigination}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Appraisal Value</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.appraisalValue}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Appraisal Date</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.appraisalDate}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Appraisal Company</span>
                                    <span class="text-sm font-semibold text-gray-900">${analysis.appraisalCompany}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mortgage Documents -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Mortgage Documents</h3>
                        <div class="space-y-3">
                            ${currentMortgage.mortgageDocuments.map(doc => `
                                <div class="border border-gray-200 rounded-lg p-4 bg-blue-50">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h4 class="font-semibold text-gray-900">${doc.type}</h4>
                                            <p class="text-sm text-gray-600">Document #${doc.docNum}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                                ${doc.status}
                                            </span>
                                            <p class="text-xs text-gray-500 mt-1">${doc.date}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Modification History -->
                    ${currentMortgage.mortgageDetails.modificationHistory && currentMortgage.mortgageDetails.modificationHistory.length > 0 ? `
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Modification History</h3>
                            <div class="space-y-3">
                                ${currentMortgage.mortgageDetails.modificationHistory.map(mod => `
                                    <div class="border border-gray-200 rounded-lg p-4 bg-yellow-50">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-semibold text-gray-900">${mod.type}</h4>
                                                <p class="text-sm text-gray-600">Amount: ${mod.amount}</p>
                                            </div>
                                            <div class="text-right">
                                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                    ${mod.status}
                                                </span>
                                                <p class="text-xs text-gray-500 mt-1">${mod.date}</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Loan Features -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Loan Features</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Prepayment Penalty</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.prepaymentPenalty ? 'Yes' : 'No'}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Assumable</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.assumable ? 'Yes' : 'No'}</span>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Origination Date</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.originationDate}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm font-medium text-gray-600">Maturity Date</span>
                                    <span class="text-sm font-semibold text-gray-900">${mortgage.maturityDate}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Schedule A: Property and Ownership Information
        function generateScheduleA(scheduleA, reportData) {
            if (!scheduleA) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                        Schedule A: Property and Ownership Information
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Property Address</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleA.propertyAddress}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Current Owner</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleA.currentOwner}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Ownership Type</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleA.ownershipType}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Estate Type</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleA.estateType}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Vesting Date</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleA.vestingDate}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Vesting Document</label>
                                <p class="text-lg font-mono text-gray-900">${scheduleA.vestingDocument}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Parcel ID</label>
                                <p class="text-lg font-mono text-gray-900">${reportData.parcelNumber}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Tax ID</label>
                                <p class="text-lg font-mono text-gray-900">${reportData.taxId}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <label class="text-sm font-medium text-gray-500">Legal Description</label>
                        <p class="text-sm text-gray-700 mt-1 bg-gray-50 p-3 rounded-lg font-mono">${scheduleA.legalDescription}</p>
                    </div>
                </div>
            `;
        }

        // Schedule B: Exceptions and Encumbrances
        function generateScheduleB(scheduleB) {
            if (!scheduleB) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        Schedule B: Exceptions and Encumbrances
                    </h2>
                    
                    ${generateLiensSection(scheduleB.liens)}
                    ${generateEasementsSection(scheduleB.easements)}
                    ${generateRestrictionsSection(scheduleB.restrictions)}
                    ${generateJudgmentsSection(scheduleB.judgments)}
                    ${generatePendingActionsSection(scheduleB.pendingActions)}
                </div>
            `;
        }

        // Schedule C: Legal Description and Jurisdiction
        function generateScheduleC(scheduleC) {
            if (!scheduleC) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Schedule C: Legal Description and Jurisdiction
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Lot Number</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.lotNumber}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Block Number</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.blockNumber}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Subdivision</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.subdivision}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Plat Book/Page</label>
                                <p class="text-lg font-semibold text-gray-900">Book ${scheduleC.platBook}, Page ${scheduleC.platPage}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Township/Range/Section</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.township}, ${scheduleC.range}, Section ${scheduleC.section}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">County</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.county}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">State</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.state}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Zoning</label>
                                <p class="text-lg font-semibold text-gray-900">${scheduleC.zoning}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <label class="text-sm font-medium text-gray-500">Zoning Restrictions</label>
                        <p class="text-sm text-gray-700 mt-1 bg-gray-50 p-3 rounded-lg">${scheduleC.zoningRestrictions}</p>
                    </div>
                </div>
            `;
        }

        // Additional helper functions for Schedule B sections
        function generateLiensSection(liens) {
            if (!liens || liens.length === 0) return '';
            
            return `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Liens</h3>
                    <div class="space-y-3">
                        ${liens.map(lien => `
                            <div class="border border-gray-200 rounded-lg p-4 ${lien.status === 'Open' ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200'}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${lien.type}</h4>
                                        <p class="text-sm text-gray-600">Parties: ${lien.parties.join(', ')}</p>
                                        <p class="text-sm text-gray-600">Amount: ${lien.amount}</p>
                                        <p class="text-sm text-gray-600">Priority: ${lien.priority}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${lien.status === 'Open' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                            ${lien.status}
                                        </span>
                                        <p class="text-xs text-gray-500 mt-1">${lien.date}</p>
                                        <p class="text-xs text-gray-500">Doc #${lien.docNum}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateEasementsSection(easements) {
            if (!easements || easements.length === 0) return '';
            
            return `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Easements</h3>
                    <div class="space-y-3">
                        ${easements.map(easement => `
                            <div class="border border-gray-200 rounded-lg p-4 bg-blue-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${easement.type}</h4>
                                        <p class="text-sm text-gray-600">Parties: ${easement.parties.join(', ')}</p>
                                        <p class="text-sm text-gray-600">Description: ${easement.description}</p>
                                        <p class="text-sm text-gray-600">Width: ${easement.width} | Location: ${easement.location}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            ${easement.status}
                                        </span>
                                        <p class="text-xs text-gray-500 mt-1">${easement.date}</p>
                                        <p class="text-xs text-gray-500">Doc #${easement.docNum}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateRestrictionsSection(restrictions) {
            if (!restrictions || restrictions.length === 0) return '';
            
            return `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Restrictions</h3>
                    <div class="space-y-3">
                        ${restrictions.map(restriction => `
                            <div class="border border-gray-200 rounded-lg p-4 bg-yellow-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${restriction.type}</h4>
                                        <p class="text-sm text-gray-600">Parties: ${restriction.parties.join(', ')}</p>
                                        <p class="text-sm text-gray-600">Description: ${restriction.description}</p>
                                        ${restriction.monthlyFee ? `<p class="text-sm text-gray-600">Monthly Fee: ${restriction.monthlyFee}</p>` : ''}
                                        ${restriction.setbacks ? `<p class="text-sm text-gray-600">Setbacks: ${restriction.setbacks}</p>` : ''}
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                            ${restriction.status}
                                        </span>
                                        <p class="text-xs text-gray-500 mt-1">${restriction.date}</p>
                                        <p class="text-xs text-gray-500">Doc #${restriction.docNum}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateJudgmentsSection(judgments) {
            if (!judgments || judgments.length === 0) return '';
            
            return `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Judgments</h3>
                    <div class="space-y-3">
                        ${judgments.map(judgment => `
                            <div class="border border-gray-200 rounded-lg p-4 bg-orange-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${judgment.type}</h4>
                                        <p class="text-sm text-gray-600">Parties: ${judgment.parties.join(', ')}</p>
                                        <p class="text-sm text-gray-600">Description: ${judgment.description}</p>
                                        ${judgment.amount ? `<p class="text-sm text-gray-600">Amount: ${judgment.amount}</p>` : ''}
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                                            ${judgment.status}
                                        </span>
                                        <p class="text-xs text-gray-500 mt-1">${judgment.date}</p>
                                        <p class="text-xs text-gray-500">Doc #${judgment.docNum}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generatePendingActionsSection(pendingActions) {
            if (!pendingActions || pendingActions.length === 0) return '';
            
            return `
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Pending Legal Actions</h3>
                    <div class="space-y-3">
                        ${pendingActions.map(action => `
                            <div class="border border-gray-200 rounded-lg p-4 bg-red-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${action.type}</h4>
                                        <p class="text-sm text-gray-600">Parties: ${action.parties.join(', ')}</p>
                                        <p class="text-sm text-gray-600">Description: ${action.description}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                            ${action.status}
                                        </span>
                                        <p class="text-xs text-gray-500 mt-1">${action.date}</p>
                                        <p class="text-xs text-gray-500">Doc #${action.docNum}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Additional section generators
        function generateChainOfTitle(ownershipChain) {
            if (!ownershipChain || ownershipChain.length === 0) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Chain of Title (Ownership History)
                    </h2>
                    
                    <div class="space-y-4">
                        ${ownershipChain.map((entry, index) => `
                            <div class="border border-gray-200 rounded-lg p-4 ${index === 0 ? 'bg-green-50 border-green-200' : 'bg-gray-50'}">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-semibold text-gray-900">${entry.owner}</h4>
                                        <p class="text-sm text-gray-600">From: ${entry.from}</p>
                                        <p class="text-sm text-gray-600">Consideration: ${entry.consideration}</p>
                                        <p class="text-sm text-gray-600">Vesting: ${entry.vesting}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${index === 0 ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                                            ${entry.deedType}
                                        </span>
                                        <p class="text-xs text-gray-500 mt-1">${entry.date}</p>
                                        <p class="text-xs text-gray-500">Doc #${entry.docNum}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateTaxInformation(taxInfo) {
            if (!taxInfo) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                        Tax Information
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Current Status</label>
                                <p class="text-lg font-semibold ${taxInfo.currentStatus === 'Paid' ? 'text-green-600' : 'text-red-600'}">
                                    ${taxInfo.currentStatus === 'Paid' ? 'Current' : `DELINQUENT - $${taxInfo.amountOwed} Owed`}
                                </p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Annual Tax Amount</label>
                                <p class="text-lg font-semibold text-gray-900">${taxInfo.annualTaxAmount}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Assessment Value</label>
                                <p class="text-lg font-semibold text-gray-900">${taxInfo.assessmentValue}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Tax Year</label>
                                <p class="text-lg font-semibold text-gray-900">${taxInfo.taxYear}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Last Payment Date</label>
                                <p class="text-lg font-semibold text-gray-900">${taxInfo.lastPaymentDate}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Exemptions</label>
                                <p class="text-lg font-semibold text-gray-900">${taxInfo.exemptions.length > 0 ? taxInfo.exemptions.join(', ') : 'None'}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Tax Liens</label>
                                <p class="text-lg font-semibold ${taxInfo.taxLiens === 'None' ? 'text-green-600' : 'text-red-600'}">${taxInfo.taxLiens}</p>
                            </div>
                        </div>
                    </div>
                    
                    ${taxInfo.specialAssessments && taxInfo.specialAssessments.length > 0 ? `
                        <div class="mt-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Special Assessments</h3>
                            <div class="space-y-3">
                                ${taxInfo.specialAssessments.map(assessment => `
                                    <div class="border border-gray-200 rounded-lg p-4 bg-yellow-50">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-semibold text-gray-900">${assessment.type}</h4>
                                                <p class="text-sm text-gray-600">Amount: ${assessment.amount}</p>
                                                <p class="text-sm text-gray-600">Due Date: ${assessment.dueDate}</p>
                                            </div>
                                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                                ${assessment.status}
                                            </span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function generateTitleInsurance(titleInsurance) {
            if (!titleInsurance) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                        Title Insurance Information
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="text-sm font-medium text-gray-500">Claims History</label>
                            <p class="text-lg font-semibold text-gray-900">${titleInsurance.claimsHistory}</p>
                        </div>
                        
                        <div>
                            <label class="text-sm font-medium text-gray-500">Title Defects</label>
                            <p class="text-lg font-semibold ${titleInsurance.titleDefects === 'None identified' ? 'text-green-600' : 'text-red-600'}">${titleInsurance.titleDefects}</p>
                        </div>
                        
                        ${titleInsurance.existingPolicies && titleInsurance.existingPolicies.length > 0 ? `
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">Existing Policies</h3>
                                <div class="space-y-3">
                                    ${titleInsurance.existingPolicies.map(policy => `
                                        <div class="border border-gray-200 rounded-lg p-4 bg-blue-50">
                                            <div class="flex justify-between items-start">
                                                <div>
                                                    <h4 class="font-semibold text-gray-900">${policy.company}</h4>
                                                    <p class="text-sm text-gray-600">Policy #${policy.policyNumber}</p>
                                                    <p class="text-sm text-gray-600">Amount: ${policy.amount}</p>
                                                    <p class="text-sm text-gray-600">Type: ${policy.type}</p>
                                                </div>
                                                <div class="text-right">
                                                    <p class="text-xs text-gray-500">${policy.date}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function generatePropertyInfo(propertyInfo) {
            if (!propertyInfo) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z" />
                        </svg>
                        Property Information
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Lot Size</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.lotSize}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Square Footage</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.squareFootage}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Bedrooms/Bathrooms</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.bedrooms} bed / ${propertyInfo.bathrooms} bath</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Year Built</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.yearBuilt}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Construction Type</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.constructionType}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Foundation</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.foundation}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Roof Type</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.roofType}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Heating/Cooling</label>
                                <p class="text-lg font-semibold text-gray-900">${propertyInfo.heatingCooling}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <label class="text-sm font-medium text-gray-500">Utilities</label>
                        <p class="text-sm text-gray-700 mt-1 bg-gray-50 p-3 rounded-lg">${propertyInfo.utilities}</p>
                    </div>
                </div>
            `;
        }

        function generateMarketInfo(marketInfo) {
            if (!marketInfo) return '';
            
            return `
                <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6 flex items-center">
                        <svg class="h-6 w-6 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                        </svg>
                        Market Information
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Estimated Value</label>
                                <p class="text-lg font-semibold text-gray-900">${marketInfo.estimatedValue}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Last Sale Price</label>
                                <p class="text-lg font-semibold text-gray-900">${marketInfo.lastSalePrice}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Last Sale Date</label>
                                <p class="text-lg font-semibold text-gray-900">${marketInfo.lastSaleDate}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm font-medium text-gray-500">Price per Sq Ft</label>
                                <p class="text-lg font-semibold text-gray-900">${marketInfo.pricePerSqFt}</p>
                            </div>
                            
                            <div>
                                <label class="text-sm font-medium text-gray-500">Comparable Sales</label>
                                <p class="text-lg font-semibold text-gray-900">${marketInfo.comparableSales}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

                    <!-- Export Buttons -->
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-6 card-hover">
                        <div class="flex flex-wrap gap-3">
                            <button onclick="exportToPDF('${address}')" class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                                <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                Export PDF
                            </button>
                        </div>
                    </div>

                    <!-- Executive Summary -->
                    <div class="bg-white rounded-2xl shadow-modern border border-gray-100 p-8 card-hover">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            Executive Summary
                        </h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Current Owner</label>
                                    <p class="text-lg font-semibold text-gray-900">${reportData.currentOwner}</p>
                                </div>
                                
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Parcel ID (APN)</label>
                                    <p class="text-lg font-mono text-gray-900">${reportData.parcelNumber}</p>
                                </div>
                            </div>
                            
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Tax Status</label>
                                    <p class="text-lg font-semibold ${reportData.taxStatus === 'Paid' ? 'text-green-600' : 'text-red-600'}">
                                        ${reportData.taxStatus === 'Paid' ? 'Current' : `DELINQUENT - $${reportData.amountOwed} Owed`}
                                    </p>
                                </div>
                                
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Title Condition</label>
                                    <div class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${getTitleConditionColor(titleCondition)}">
                                        ${getTitleConditionIcon(titleCondition)}
                                        ${titleCondition}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Property & Vesting Information -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Property & Vesting Information</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Property Address</label>
                                    <p class="text-gray-900">${reportData.propertySitus}</p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Current Vesting</label>
                                    <p class="text-gray-900">${reportData.currentOwner}</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Vesting Deed</label>
                                    <p class="text-gray-900">
                                        ${reportData.ownershipChain[0]?.deedType}, Document #${reportData.ownershipChain[0]?.docNum}, 
                                        Recorded ${reportData.ownershipChain[0]?.date}
                                    </p>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-gray-500">Legal Description</label>
                                    <p class="text-sm text-gray-600">${reportData.legalDescription}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chain of Title -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Chain of Title (50-Year History)
                        </h2>
                        
                        <div class="space-y-4">
                            ${reportData.ownershipChain.map((entry, index) => `
                                <div class="border-l-4 border-blue-200 pl-4 py-2">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <p class="font-semibold text-gray-900">${entry.owner}</p>
                                            <p class="text-sm text-gray-600">
                                                from <span class="font-medium">${entry.from}</span>
                                            </p>
                                        </div>
                                        <div class="text-right text-sm text-gray-500">
                                            <p class="font-medium">${entry.deedType}</p>
                                            <p>${entry.date}</p>
                                            <p class="font-mono text-xs">Doc #${entry.docNum}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="font-semibold text-gray-900 mb-2">Chain Analysis</h3>
                            <p class="text-sm text-gray-700">${chainAnalysis}</p>
                        </div>
                    </div>

                    <!-- Schedule B -->
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <svg class="h-6 w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            Schedule B: Exceptions & Encumbrances
                        </h2>
                        
                        ${reportData.encumbrances.length === 0 ? `
                            <div class="text-center py-8">
                                <svg class="h-12 w-12 text-green-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                <p class="text-lg font-medium text-gray-900">No significant encumbrances found.</p>
                                <p class="text-sm text-gray-600 mt-2">This property appears to have a clear title.</p>
                            </div>
                        ` : `
                            <div class="space-y-4">
                                ${reportData.encumbrances.map((encumbrance, index) => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <h3 class="font-semibold text-gray-900">${encumbrance.type}</h3>
                                            <div class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(encumbrance.status)}">
                                                ${getStatusIcon(encumbrance.status)}
                                                <span class="ml-1">${encumbrance.status}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="space-y-2 text-sm">
                                            <div>
                                                <span class="font-medium text-gray-700">Parties:</span>
                                                <span class="ml-2 text-gray-600">${encumbrance.parties.join(' and ')}</span>
                                            </div>
                                            
                                            <div>
                                                <span class="font-medium text-gray-700">Details:</span>
                                                <span class="ml-2 text-gray-600">
                                                    Document #${encumbrance.docNum}, Recorded ${encumbrance.date}
                                                </span>
                                            </div>
                                            
                                            ${encumbrance.amount ? `
                                                <div>
                                                    <span class="font-medium text-gray-700">Amount:</span>
                                                    <span class="ml-2 text-gray-600">${encumbrance.amount}</span>
                                                </div>
                                            ` : ''}
                                            
                                            ${encumbrance.description ? `
                                                <div>
                                                    <span class="font-medium text-gray-700">Description:</span>
                                                    <span class="ml-2 text-gray-600">${encumbrance.description}</span>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Helper functions for styling
        function getTitleConditionColor(condition) {
            switch (condition) {
                case 'Appears Clear':
                    return 'status-clear text-white';
                case 'Exceptions Found':
                    return 'status-warning text-white';
                case 'Significant Clouds Detected - Professional Review Required':
                    return 'status-danger text-white';
                default:
                    return 'text-gray-600 bg-gray-50';
            }
        }

        function getTitleConditionIcon(condition) {
            switch (condition) {
                case 'Significant Clouds Detected - Professional Review Required':
                    return '<svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                case 'Exceptions Found':
                    return '<svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                case 'Appears Clear':
                    return '<svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                default:
                    return '';
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Potentially Open':
                    return 'text-red-600 bg-red-50';
                case 'Satisfied':
                    return 'text-green-600 bg-green-50';
                case 'Active':
                    return 'text-blue-600 bg-blue-50';
                default:
                    return 'text-yellow-600 bg-yellow-50';
            }
        }

        function getStatusIcon(status) {
            switch (status) {
                case 'Potentially Open':
                    return '<svg class="h-5 w-5 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
                case 'Satisfied':
                    return '<svg class="h-5 w-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                case 'Active':
                    return '<svg class="h-5 w-5 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>';
                default:
                    return '<svg class="h-5 w-5 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            }
        }

        // Export to PDF function
        function exportToPDF(address) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            let yPosition = 20;

            // Title
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('Preliminary Title Report', pageWidth / 2, yPosition, { align: 'center' });
            yPosition += 15;

            // Property info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Subject Property: ${address}`, 20, yPosition);
            yPosition += 10;
            doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, yPosition);
            yPosition += 20;

            // Disclaimer
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('CRITICAL DISCLAIMER:', 20, yPosition);
            yPosition += 8;
            doc.setFont('helvetica', 'normal');
            const disclaimerText = 'This is an informational, automated report based on a search of online public records. It is NOT a substitute for a professional title examination or a policy of title insurance. Data may be incomplete or inaccurate. All findings must be verified by a qualified abstractor, attorney, or title company before any real estate transaction.';
            const disclaimerLines = doc.splitTextToSize(disclaimerText, pageWidth - 40);
            doc.text(disclaimerLines, 20, yPosition);
            yPosition += disclaimerLines.length * 5 + 15;

            // Executive Summary
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('Executive Summary', 20, yPosition);
            yPosition += 10;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            
            const property = findPropertyByAddress(address);
            if (property) {
                doc.text(`Current Owner: ${property.data.currentOwner}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Parcel ID: ${property.data.parcelNumber}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Tax Status: ${property.data.taxStatus === 'Paid' ? 'Current' : `DELINQUENT - $${property.data.amountOwed} Owed`}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Title Condition: ${analyzeTitleCondition(property.data.encumbrances)}`, 20, yPosition);
                yPosition += 15;

                // Chain of Title
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('Chain of Title', 20, yPosition);
                yPosition += 10;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                
                property.data.ownershipChain.forEach((entry, index) => {
                    if (yPosition > pageHeight - 30) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    doc.text(`${index + 1}. ${entry.owner} from ${entry.from} (${entry.deedType}, ${entry.date})`, 20, yPosition);
                    yPosition += 6;
                });

                yPosition += 10;
                doc.setFont('helvetica', 'bold');
                doc.text('Chain Analysis:', 20, yPosition);
                yPosition += 6;
                doc.setFont('helvetica', 'normal');
                const analysisLines = doc.splitTextToSize(analyzeChainOfTitle(property.data.ownershipChain), pageWidth - 40);
                doc.text(analysisLines, 20, yPosition);
            }

            doc.save(`title-report-${address.replace(/[^a-zA-Z0-9]/g, '-')}.pdf`);
        }

        // Advanced Error Handling & Analytics
        class TitleGuardAnalytics {
            constructor() {
                this.sessionId = this.generateSessionId();
                this.startTime = Date.now();
                this.trackEvent('app_loaded');
            }
            
            generateSessionId() {
                return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            trackEvent(eventName, properties = {}) {
                const event = {
                    sessionId: this.sessionId,
                    event: eventName,
                    timestamp: new Date().toISOString(),
                    properties: properties,
                    userAgent: navigator.userAgent,
                    url: window.location.href
                };
                
                // Store in localStorage for analytics
                const events = JSON.parse(localStorage.getItem('tg_events') || '[]');
                events.push(event);
                localStorage.setItem('tg_events', JSON.stringify(events.slice(-100))); // Keep last 100 events
                
                console.log('Analytics Event:', event);
            }
            
            trackSearch(address, success, duration) {
                this.trackEvent('search_performed', {
                    address: address,
                    success: success,
                    duration: duration,
                    timestamp: Date.now() - this.startTime
                });
            }
            
            trackSearch(searchInput, success, duration, searchType) {
                this.trackEvent('search_performed', {
                    searchInput: searchInput,
                    searchType: searchType,
                    success: success,
                    duration: duration,
                    timestamp: Date.now() - this.startTime
                });
            }
        }
        
        const analytics = new TitleGuardAnalytics();
        
        // Simplified Search Management
        class SearchManager {
            constructor() {
                this.setupAddressAutocomplete();
                this.setupTaxIdAutocomplete();
            }
            
            setupSearchTypeToggle() {
                const searchTypeRadios = document.querySelectorAll('input[name="searchType"]');
                const searchLabel = document.getElementById('searchLabel');
                const searchInput = document.getElementById('searchInput');
                const searchIcon = document.getElementById('searchIcon');
                
                searchTypeRadios.forEach(radio => {
                    radio.addEventListener('change', () => {
                        this.updateSearchInterface(radio.value);
                    });
                });
            }
            
            updateSearchInterface(searchType) {
                const searchLabel = document.getElementById('searchLabel');
                const searchInput = document.getElementById('searchInput');
                const searchIcon = document.getElementById('searchIcon');
                
                switch (searchType) {
                    case 'address':
                        searchLabel.textContent = 'Property Address';
                        searchInput.placeholder = 'Enter property address (e.g., 123 Main St, Anytown, USA)';
                        searchInput.setAttribute('autocomplete', 'address-line1');
                        searchIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />';
                        break;
                case 'tax':
                    searchLabel.textContent = 'Tax ID / Parcel Number';
                    searchInput.placeholder = 'Enter Tax ID or Parcel Number (e.g., R12345-001-002)';
                    searchInput.setAttribute('autocomplete', 'off');
                    searchIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />';
                    break;
                }
                
                // Clear input and suggestions
                searchInput.value = '';
                document.getElementById('searchSuggestions').classList.add('hidden');
                document.getElementById('searchValidation').innerHTML = '';
            }
            
            setupAddressAutocomplete() {
                const searchInput = document.getElementById('searchInput');
                const suggestionsDiv = document.getElementById('searchSuggestions');
                
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase();
                    const searchType = document.querySelector('input[name="searchType"]:checked').value;
                    
                    if (query.length < 2) {
                        suggestionsDiv.classList.add('hidden');
                        return;
                    }
                    
                    const suggestions = this.getSearchSuggestions(query, searchType);
                    this.displaySuggestions(suggestions, searchType);
                });
                
                // Hide suggestions when clicking outside
                document.addEventListener('click', (e) => {
                    if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                        suggestionsDiv.classList.add('hidden');
                    }
                });
            }
            
            getSearchSuggestions(query, searchType) {
                const suggestions = [];
                
                for (const [address, data] of Object.entries(mockProperties)) {
                    switch (searchType) {
                        case 'address':
                            if (address.toLowerCase().includes(query)) {
                                suggestions.push({ type: 'address', value: address, display: address });
                            }
                            break;
                        case 'tax':
                            // Search both parcel number and tax ID
                            if (data.parcelNumber.toLowerCase().includes(query) || 
                                (data.taxId && data.taxId.toLowerCase().includes(query))) {
                                suggestions.push({ 
                                    type: 'tax', 
                                    value: data.parcelNumber, // Use parcel number as primary identifier
                                    display: `${data.parcelNumber} - ${address}` 
                                });
                            }
                            break;
                    }
                }
                
                return suggestions.slice(0, 5);
            }
            
            displaySuggestions(suggestions, searchType) {
                const suggestionsDiv = document.getElementById('searchSuggestions');
                
                if (suggestions.length === 0) {
                    suggestionsDiv.classList.add('hidden');
                    return;
                }
                
                const iconMap = {
                    address: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />',
                    tax: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />'
                };
                
                suggestionsDiv.innerHTML = suggestions.map(suggestion => `
                    <div class="px-4 py-2 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0" onclick="selectSuggestion('${suggestion.value}', '${suggestion.type}')">
                        <div class="flex items-center">
                            <svg class="w-4 h-4 text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                ${iconMap[suggestion.type]}
                            </svg>
                            <span class="text-sm text-gray-700">${suggestion.display}</span>
                        </div>
                    </div>
                `).join('');
                
                suggestionsDiv.classList.remove('hidden');
            }
            
            setupAdvancedOptions() {
                const toggleBtn = document.getElementById('toggleAdvanced');
                const optionsDiv = document.getElementById('advancedOptions');
                const toggleText = document.getElementById('toggleText');
                const toggleIcon = document.getElementById('toggleIcon');
                
                toggleBtn.addEventListener('click', () => {
                    const isHidden = optionsDiv.classList.contains('hidden');
                    
                    if (isHidden) {
                        optionsDiv.classList.remove('hidden');
                        toggleText.textContent = 'Hide Options';
                        toggleIcon.style.transform = 'rotate(180deg)';
                    } else {
                        optionsDiv.classList.add('hidden');
                        toggleText.textContent = 'Show Options';
                        toggleIcon.style.transform = 'rotate(0deg)';
                    }
                });
            }
            
            setupRealTimeValidation() {
                const searchInput = document.getElementById('searchInput');
                const validationDiv = document.getElementById('searchValidation');
                
                searchInput.addEventListener('input', () => {
                    const searchType = document.querySelector('input[name="searchType"]:checked').value;
                    const validation = validateSearchInput(searchInput.value, searchType);
                    this.displayValidation(validation, validationDiv);
                });
            }
            
            displayValidation(validation, container) {
                if (validation.isValid) {
                    container.innerHTML = '<div class="flex items-center text-green-600"><svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>Valid address format</div>';
                } else {
                    container.innerHTML = validation.errors.map(error => 
                        `<div class="flex items-center text-red-600"><svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>${error}</div>`
                    ).join('');
                }
            }
        }
        
        // Initialize advanced search features
        const searchManager = new SearchManager();
        
        // Global function for suggestion selection
        window.selectSuggestion = function(value, type) {
            document.getElementById('searchInput').value = value;
            document.getElementById('searchSuggestions').classList.add('hidden');
            analytics.trackEvent('search_suggestion_selected', { value: value, type: type });
        };
        
        // Advanced Error Handling
        class ErrorHandler {
            static showError(message, type = 'error') {
                const errorContainer = document.getElementById('errorContainer') || this.createErrorContainer();
                
                const errorElement = document.createElement('div');
                errorElement.className = `fixed top-4 right-4 z-50 max-w-md p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full ${
                    type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' : 
                    type === 'warning' ? 'bg-yellow-50 border border-yellow-200 text-yellow-800' :
                    'bg-blue-50 border border-blue-200 text-blue-800'
                }`;
                
                errorElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                        <div class="ml-4 flex-shrink-0">
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                                <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                `;
                
                errorContainer.appendChild(errorElement);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (errorElement.parentElement) {
                        errorElement.style.transform = 'translateX(100%)';
                        setTimeout(() => errorElement.remove(), 300);
                    }
                }, 5000);
                
                // Show immediately
                setTimeout(() => {
                    errorElement.style.transform = 'translateX(0)';
                }, 100);
            }
            
            static createErrorContainer() {
                const container = document.createElement('div');
                container.id = 'errorContainer';
                container.className = 'fixed top-4 right-4 z-50 space-y-2';
                document.body.appendChild(container);
                return container;
            }
        }
        
        // Enhanced Form Validation
        function validateSearchInput(input, searchType) {
            const errors = [];
            const trimmedInput = input.trim();
            
            if (!trimmedInput) {
                errors.push(`Please enter a ${searchType === 'address' ? 'property address' : 'tax ID or parcel number'}`);
                return { isValid: false, errors };
            }
            
            switch (searchType) {
                case 'address':
                    if (trimmedInput.length < 5) {
                        errors.push('Address must be at least 5 characters long');
                    } else if (!/^[a-zA-Z0-9\s,.-]+$/.test(trimmedInput)) {
                        errors.push('Address contains invalid characters');
                    }
                    break;
                    
                case 'tax':
                    if (!/^[A-Z0-9-]+$/i.test(trimmedInput)) {
                        errors.push('Tax ID/Parcel Number must contain only letters, numbers, and hyphens');
                    } else if (trimmedInput.length < 3) {
                        errors.push('Tax ID/Parcel Number must be at least 3 characters long');
                    }
                    break;
            }
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }
        
        // Legacy function for backward compatibility
        function validateAddress(address) {
            return validateSearchInput(address, 'address');
        }
        
        // Enhanced Search with Progress Tracking
        function performSearch(searchInput, searchType) {
            const startTime = Date.now();
            
            return new Promise((resolve, reject) => {
                // Simulate realistic search phases based on search type
                const phases = searchType === 'address' ? [
                    { name: 'Connecting to databases...', duration: 500 },
                    { name: 'Retrieving property information...', duration: 800 },
                    { name: 'Analyzing chain of title...', duration: 1000 },
                    { name: 'Searching encumbrances...', duration: 700 },
                    { name: 'Generating report...', duration: 500 }
                ] : [
                    { name: 'Connecting to tax/assessor database...', duration: 400 },
                    { name: 'Looking up tax ID/parcel information...', duration: 600 },
                    { name: 'Retrieving property details...', duration: 500 },
                    { name: 'Analyzing chain of title...', duration: 1000 },
                    { name: 'Searching encumbrances...', duration: 700 },
                    { name: 'Generating report...', duration: 500 }
                ];
                
                let currentPhase = 0;
                
                function updateProgress() {
                    if (currentPhase < phases.length) {
                        const phase = phases[currentPhase];
                        updateSearchButton(`${phase.name}`, true);
                        
                        setTimeout(() => {
                            currentPhase++;
                            updateProgress();
                        }, phase.duration);
                    } else {
                        const property = findPropertyBySearchInput(searchInput, searchType);
                        const duration = Date.now() - startTime;
                        
                        if (property) {
                            analytics.trackSearch(searchInput, true, duration, searchType);
                            resolve({ property, duration });
                        } else {
                            analytics.trackSearch(searchInput, false, duration, searchType);
                            reject(new Error('Property not found'));
                        }
                    }
                }
                
                updateProgress();
            });
        }
        
        function updateSearchButton(text, isLoading) {
            const searchBtn = document.getElementById('searchBtn');
            if (isLoading) {
                searchBtn.innerHTML = `
                    <svg class="h-5 w-5 animate-spin mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span>${text}</span>
                `;
                searchBtn.disabled = true;
            } else {
                searchBtn.innerHTML = `
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span>Search Title</span>
                `;
                searchBtn.disabled = false;
            }
        }
        
        // Enhanced Form Submission Handler
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('searchForm');
            if (!searchForm) {
                console.error('Search form not found!');
                return;
            }
            
            searchForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                console.log('Form submitted!');
                
                const addressInput = document.getElementById('addressInput').value.trim();
                const taxIdInput = document.getElementById('taxIdInput').value.trim();
                
                console.log('Address input:', addressInput);
                console.log('Tax ID input:', taxIdInput);
            
            // Determine which input has a value
            let searchInput, searchType;
            if (addressInput && !taxIdInput) {
                searchInput = addressInput;
                searchType = 'address';
            } else if (taxIdInput && !addressInput) {
                searchInput = taxIdInput;
                searchType = 'tax';
            } else if (addressInput && taxIdInput) {
                ErrorHandler.showError('Please enter either an address OR a Tax ID/Parcel Number, not both.', 'error');
                return;
            } else {
                ErrorHandler.showError('Please enter either a property address or Tax ID/Parcel Number to search.', 'error');
                return;
            }
            
            // Validate input
            const validation = validateSearchInput(searchInput, searchType);
            if (!validation.isValid) {
                validation.errors.forEach(error => {
                    ErrorHandler.showError(error, 'error');
                });
                return;
            }
            
            try {
                const result = await performSearch(searchInput, searchType);
                const { property, duration } = result;
                
                // Generate and display report
                const reportHTML = generateReportHTML(property.data, property.address);
                document.getElementById('reportDisplay').innerHTML = reportHTML;
                document.getElementById('reportDisplay').classList.remove('hidden');
                
                // Smooth scroll to report
                document.getElementById('reportDisplay').scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Show success message
                ErrorHandler.showError(`Search completed successfully in ${(duration/1000).toFixed(1)}s`, 'success');
                
            } catch (error) {
                const testExamples = searchType === 'address' ? 
                    'â€¢ 123 Main St, Anytown, USA\nâ€¢ 456 Oak Avenue, Springfield, IL' :
                    'â€¢ R12345-001-002\nâ€¢ R67890-003-001';
                
                ErrorHandler.showError(
                    `Property not found. Please try one of the test ${searchType === 'address' ? 'addresses' : 'tax IDs/parcel numbers'}:\n${testExamples}`,
                    'warning'
                );
            }
        });
        });
    </script>
</body>
</html>
